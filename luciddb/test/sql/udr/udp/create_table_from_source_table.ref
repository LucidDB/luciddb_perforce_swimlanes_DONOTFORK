> -- test the create_table_from_source_table UDP
> 
> -- setup a schema and couples of tables for testing.
> create schema "S";
> set schema 'S';
> 
> create table T1 (col1 varchar(50));
> create view T2 
> description 'test for create_table_from_source_table UDP'
> as select * from "S"."T1";
> 
> -- test to make sure datatypes, precision match
> call applib.create_table_from_source_table ( '"S"."T1"', null, 'T1_TARGET', null);
> select TABLE_NAME,COLUMN_NAME,DATATYPE,"PRECISION",IS_NULLABLE from sys_root.dba_columns where table_name like 'T1%' and schema_name = 'S';
+-------------+--------------+-----------+------------+--------------+
| TABLE_NAME  | COLUMN_NAME  | DATATYPE  | PRECISION  | IS_NULLABLE  |
+-------------+--------------+-----------+------------+--------------+
| T1          | COL1         | VARCHAR   | 50         | true         |
| T1_TARGET   | COL1         | VARCHAR   | 50         | true         |
+-------------+--------------+-----------+------------+--------------+
> 
> -- test to make sure it works with tables and views
> call applib.create_table_from_source_table ( '"S"."T2"', null, 'T2_TARGET', null);
> select TABLE_NAME,COLUMN_NAME,DATATYPE,"PRECISION",IS_NULLABLE from sys_root.dba_columns where table_name like 'T2%' and schema_name = 'S';
+-------------+--------------+-----------+------------+--------------+
| TABLE_NAME  | COLUMN_NAME  | DATATYPE  | PRECISION  | IS_NULLABLE  |
+-------------+--------------+-----------+------------+--------------+
| T2          | COL1         | VARCHAR   | 50         | true         |
| T2_TARGET   | COL1         | VARCHAR   | 50         | true         |
+-------------+--------------+-----------+------------+--------------+
> 
> -- test adding additional columns
> call applib.create_table_from_source_table ( '"S"."T1"', null, 'T3_TARGET', 'desc varchar(255)');
> select TABLE_NAME,COLUMN_NAME,DATATYPE,"PRECISION",IS_NULLABLE from sys_root.dba_columns where table_name in ('T1','T3_TARGET')  and schema_name = 'S';
+-------------+--------------+-----------+------------+--------------+
| TABLE_NAME  | COLUMN_NAME  | DATATYPE  | PRECISION  | IS_NULLABLE  |
+-------------+--------------+-----------+------------+--------------+
| T1          | COL1         | VARCHAR   | 50         | true         |
| T3_TARGET   | COL1         | VARCHAR   | 50         | true         |
| T3_TARGET   | DESC         | VARCHAR   | 255        | true         |
+-------------+--------------+-----------+------------+--------------+
> 
> -- test to make sure that it works with remote tables
> --TODO: NOT UNDERSTAND REMOTE TABLES.
> 
> -- test to make sure errors are thrown when:
> --table already exists 
> call applib.create_table_from_source_table ( '"S"."T1"', null, 'T1_TARGET', null);
Error: java.lang.Exception: [ErrorInfo]: The table[S.T1_TARGET] is existing.
[Create Table SQL:] (state=,code=0)
> 
> --additional columns clause contains another column already in the table
> call applib.create_table_from_source_table ( '"S"."T1"', null, 'T4_TARGET', 'col1 varchar(25)');
Error: java.lang.Exception: [ErrorInfo]: DDL validation error near line 1, column 49: Duplicate definition for column "COL1" within table "S"."T4_TARGET"; earlier definition was near line 1, column 32
[Create Table SQL:] Create Table "S"."T4_TARGET" ( COL1 VARCHAR(50),col1 varchar(25) ) (state=,code=0)
> 
> --additional columns clause is invalid 
> call applib.create_table_from_source_table ( '"S"."T1"', null, 'T5_TARGET', 'desc vachar(50)');
Error: java.lang.Exception: [ErrorInfo]: DDL validation error near line 1, column 49: Reference to unknown datatype "VACHAR"
[Create Table SQL:] Create Table "S"."T5_TARGET" ( COL1 VARCHAR(50),desc vachar(50) ) (state=,code=0)
> 
> -- do cleanup
> drop view "T2";
> drop table "T1";
> drop table "T1_TARGET";
> drop table "T2_TARGET";
> drop table "T3_TARGET";
> drop schema "S";
> !quit
