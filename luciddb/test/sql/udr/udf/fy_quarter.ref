0: jdbc:luciddb:> -- $Id: //open/lu/dev/luciddb/test/sql/udr/udf/fy_quarter.sql#1 $
0: jdbc:luciddb:> -- Tests for FYQuarter UDF
0: jdbc:luciddb:> set schema 'udftest';
0: jdbc:luciddb:> set path 'udftest';
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- define functions
0: jdbc:luciddb:> create function fy_quarter(yr integer, mth integer, fm integer)
. . . . . . . . > returns varchar(10)
. . . . . . . . > language java
. . . . . . . . > specific fy_quarter_ymfm
. . . . . . . . > no sql
. . . . . . . . > external name 'class com.lucidera.luciddb.applib.FYQuarter.FunctionExecute';
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create function fy_quarter(dt date, fm integer)
. . . . . . . . > returns varchar(10)
. . . . . . . . > language java
. . . . . . . . > specific fy_quarter_date
. . . . . . . . > no sql
. . . . . . . . > external name 'class com.lucidera.luciddb.applib.FYQuarter.FunctionExecute';
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create function fy_quarter(ts timestamp, fm integer)
. . . . . . . . > returns varchar(10)
. . . . . . . . > language java
. . . . . . . . > specific fy_quarter_timestamp
. . . . . . . . > no sql
. . . . . . . . > external name 'class com.lucidera.luciddb.applib.FYQuarter.FunctionExecute';
0: jdbc:luciddb:> 
0: jdbc:luciddb:> 
0: jdbc:luciddb:> values fy_quarter(1210, 8, 4);
+---------+
| EXPR$0  |
+---------+
| Q2FY11  |
+---------+
0: jdbc:luciddb:> values fy_quarter(date'2222-12-25', 6);
+---------+
| EXPR$0  |
+---------+
| Q3FY23  |
+---------+
0: jdbc:luciddb:> values fy_quarter(timestamp'1879-8-05 10:29:45.05', 1);
+---------+
| EXPR$0  |
+---------+
| Q3FY79  |
+---------+
0: jdbc:luciddb:> values fy_quarter(date'1601-11-12', 12);
+---------+
| EXPR$0  |
+---------+
| Q4FY01  |
+---------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- these should fail
0: jdbc:luciddb:> values fy_quarter(date'2000-7-30', 3, 2);
Error: From line 1, column 8 to line 1, column 40: No match found for function signature FY_QUARTER(<DATE>, <NUMERIC>, <NUMERIC>) (state=,code=0)
0: jdbc:luciddb:> values fy_quarter('2001-9-12', 3);
Error: From line 1, column 8 to line 1, column 33: No match found for function signature FY_QUARTER(<CHARACTER>, <NUMERIC>) (state=,code=0)
0: jdbc:luciddb:> values fy_quarter(timestamp'1800-13-01 12:45:38', 1);
Error: org.eigenbase.sql.parser.SqlParseException: Illegal TIMESTAMP literal '1800-13-01 12:45:38' at line 1, column 28: not in format 'yyyy-MM-dd HH:mm:ss' (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- create view with reference to fy_quarter
0: jdbc:luciddb:> create view fy(fm, fromdt, fromts) as
. . . . . . . . > select fm, fy_quarter(datecol, fm), fy_quarter(tscol, fm)
. . . . . . . . > from data_source;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from fy 
. . . . . . . . > order by 1;
+-----+---------+---------+
| FM  | FROMDT  | FROMTS  |
+-----+---------+---------+
| 1   | Q3FY45  | Q4FY10  |
| 2   | Q4FY06  | Q2FY02  |
| 10  | Q2FY93  | Q1FY65  |
+-----+---------+---------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- in expressions
0: jdbc:luciddb:> select fm, 'combo: ' || fy_quarter(datecol, fm) || fy_quarter(tscol, fm)
. . . . . . . . > from data_source
. . . . . . . . > order by 1;
+-----+----------------------+
| FM  |        EXPR$1        |
+-----+----------------------+
| 1   | combo: Q3FY45Q4FY10  |
| 2   | combo: Q4FY06Q2FY02  |
| 10  | combo: Q2FY93Q1FY65  |
+-----+----------------------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> 
0: jdbc:luciddb:> !quit
