0: jdbc:luciddb:> -- $Id: //open/lu/dev/luciddb/test/sql/udr/udf/udfInvocation.sql#5 $
0: jdbc:luciddb:> -- Test queries with UDF invocations
0: jdbc:luciddb:> 
0: jdbc:luciddb:> set schema 'udftest';
0: jdbc:luciddb:> 
0: jdbc:luciddb:> set path 'udftest';
0: jdbc:luciddb:> 
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- test CharReplace
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create function replaceChar(str varchar(128), oldC varchar(128), newC varchar(128)) 
. . . . . . . . > returns varchar(128)
. . . . . . . . > language java
. . . . . . . . > no sql
. . . . . . . . > external name 'class com.lucidera.luciddb.applib.CharReplace.FunctionExecute';
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create function replaceCharInt(str varchar(128), oldC integer, newC integer) 
. . . . . . . . > returns varchar(128)
. . . . . . . . > language java
. . . . . . . . > no sql
. . . . . . . . > external name 'class com.lucidera.luciddb.applib.CharReplace.FunctionExecute';
0: jdbc:luciddb:> 
0: jdbc:luciddb:> values replaceChar('AA AA AA AA', 'A', 'B');
+--------------+
|    EXPR$0    |
+--------------+
| BB BB BB BB  |
+--------------+
0: jdbc:luciddb:> values replaceChar('bb bb bb bb', 'b', 'A');
+--------------+
|    EXPR$0    |
+--------------+
| AA AA AA AA  |
+--------------+
0: jdbc:luciddb:> values replaceChar('bbbbbbbb', 'b', 'AA');
Error: java.lang.IllegalArgumentException: replacement string should be a char (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> values replaceCharInt('111111', 49, 51);
+---------+
| EXPR$0  |
+---------+
| 333333  |
+---------+
0: jdbc:luciddb:> values replaceCharInt('//////', 47, 42);
+---------+
| EXPR$0  |
+---------+
| ******  |
+---------+
0: jdbc:luciddb:> values replaceCharInt('******', 42, 49);
+---------+
| EXPR$0  |
+---------+
| 111111  |
+---------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- test FYMonth
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create function calcFiscalMonth(d Date, firstMo integer) 
. . . . . . . . > returns integer
. . . . . . . . > language java
. . . . . . . . > no sql
. . . . . . . . > external name 'class com.lucidera.luciddb.applib.FYMonth.FunctionExecute';
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- fails: cannot override function
0: jdbc:luciddb:> create function calcFiscalMonth(t Timestamp, firstMo integer) 
. . . . . . . . > returns integer
. . . . . . . . > language java
. . . . . . . . > no sql
. . . . . . . . > external name 'class com.lucidera.luciddb.applib.FYMonth.FunctionExecute';
Error: DDL validation error near line 1, column 8: Target schema "LOCALDB"."UDFTEST" already contains routine "CALCFISCALMONTH" with same name (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create function calcFiscalMonthT(t Timestamp, firstMo integer) 
. . . . . . . . > returns integer
. . . . . . . . > language java
. . . . . . . . > no sql
. . . . . . . . > external name 'class com.lucidera.luciddb.applib.FYMonth.FunctionExecute';
0: jdbc:luciddb:> 
0: jdbc:luciddb:> values calcFiscalMonth(DATE '2005-10-12', 3);
+---------+
| EXPR$0  |
+---------+
| 8       |
+---------+
0: jdbc:luciddb:> values calcFiscalMonth(DATE '2006-1-12', 1);
+---------+
| EXPR$0  |
+---------+
| 1       |
+---------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> values calcFiscalMonthT(TIMESTAMP '2006-2-12 13:00:00', 3);
+---------+
| EXPR$0  |
+---------+
| 12      |
+---------+
0: jdbc:luciddb:> values calcFiscalMonthT(TIMESTAMP '1999-3-3 00:00:00', 3);
+---------+
| EXPR$0  |
+---------+
| 1       |
+---------+
0: jdbc:luciddb:> values calcFiscalMonthT(TIMESTAMP '2006-4-12 13:00:00', 3);
+---------+
| EXPR$0  |
+---------+
| 2       |
+---------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- test CleanPhone
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create function cleanPhone(num varchar(128))
. . . . . . . . > returns varchar(128)
. . . . . . . . > language java
. . . . . . . . > no sql
. . . . . . . . > external name 'class com.lucidera.luciddb.applib.CleanPhone.FunctionExecute';
0: jdbc:luciddb:> 
0: jdbc:luciddb:> values cleanPhone('1 2 3 4 5 6 7 8 9  0');
+-----------------+
|     EXPR$0      |
+-----------------+
| (123) 456-7890  |
+-----------------+
0: jdbc:luciddb:> values cleanPhone('123456789012');
+---------------+
|    EXPR$0     |
+---------------+
| 123456789012  |
+---------------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create function cleanPhoneFormat(num varchar(128), format integer)
. . . . . . . . > returns varchar(128)
. . . . . . . . > language java
. . . . . . . . > no sql
. . . . . . . . > external name 'class com.lucidera.luciddb.applib.CleanPhone.FunctionExecute';
0: jdbc:luciddb:> 
0: jdbc:luciddb:> values cleanPhoneFormat('123 456 789 012', 1);
+------------------+
|      EXPR$0      |
+------------------+
| 123 456 789 012  |
+------------------+
0: jdbc:luciddb:> values cleanPhoneFormat('123.456.7890', 0);
+---------------+
|    EXPR$0     |
+---------------+
| 123-456-7890  |
+---------------+
0: jdbc:luciddb:> values cleanPhoneFormat('1234567890', -1);
Error: java.lang.IllegalArgumentException: invalid phone output format (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create function cleanPhoneFormRjct(num varchar(128), format integer, reject boolean)
. . . . . . . . > returns varchar(128)
. . . . . . . . > language java
. . . . . . . . > no sql
. . . . . . . . > external name 'class com.lucidera.luciddb.applib.CleanPhone.FunctionExecute';
0: jdbc:luciddb:> 
0: jdbc:luciddb:> values cleanPhoneFormRjct('1234567890', 1, true);
+-----------------+
|     EXPR$0      |
+-----------------+
| (123) 456-7890  |
+-----------------+
0: jdbc:luciddb:> values cleanPhoneFormRjct('123456789012', 1, false);
+---------------+
|    EXPR$0     |
+---------------+
| 123456789012  |
+---------------+
0: jdbc:luciddb:> values cleanPhoneFormRjct('123456789012', 1, true);
Error: java.lang.IllegalArgumentException: null (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create function cleanPhoneFormRjct2(num varchar(128), format varchar(128), reject boolean)
. . . . . . . . > returns varchar(128)
. . . . . . . . > language java
. . . . . . . . > no sql
. . . . . . . . > external name 'class com.lucidera.luciddb.applib.CleanPhone.FunctionExecute';
0: jdbc:luciddb:> 
0: jdbc:luciddb:> values cleanPhoneFormRjct2('aBcDeFgHiJkLm', '(999) 999 999 999 9', true);
+----------------------+
|        EXPR$0        |
+----------------------+
| (222) 333 444 555 6  |
+----------------------+
0: jdbc:luciddb:> values cleanPhoneFormRjct2('1800TESTING', '9-999-999-9999', true);
+-----------------+
|     EXPR$0      |
+-----------------+
| 1-800-837-8464  |
+-----------------+
0: jdbc:luciddb:> values cleanPhoneFormRjct2('123-4567-890123', '(999)9999999', true);
Error: java.lang.IllegalArgumentException: null (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> !quit
