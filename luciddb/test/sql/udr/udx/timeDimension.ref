0: jdbc:luciddb:> -- $ID: //open/lu/dev/luciddb/test/sql/udr/udx/timeDimension.sql#3 $ 
0: jdbc:luciddb:> -- Tests for TimeDimension UDX
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create schema udxtest;
0: jdbc:luciddb:> set schema 'udxtest';
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- Positive tests
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from table(applib.time_dimension(1997, 2, 29, 1997, 3, 2))
. . . . . . . . > order by time_key_seq;
+---------------+-------------+--------------+----------+---------------------+----------------------+---------------------+---------------------+----------------------+----------------------+-------------+-----------------------+-----------------------+----------+-------+-------------------+--------------------+
| TIME_KEY_SEQ  |  TIME_KEY   | DAY_OF_WEEK  | WEEKEND  | DAY_NUMBER_IN_WEEK  | DAY_NUMBER_IN_MONTH  | DAY_NUMBER_IN_YEAR  | DAY_NUMBER_OVERALL  | WEEK_NUMBER_IN_YEAR  | WEEK_NUMBER_OVERALL  | MONTH_NAME  | MONTH_NUMBER_IN_YEAR  | MONTH_NUMBER_OVERALL  | QUARTER  |  YR   | CALENDAR_QUARTER  | FIRST_DAY_OF_WEEK  |
+---------------+-------------+--------------+----------+---------------------+----------------------+---------------------+---------------------+----------------------+----------------------+-------------+-----------------------+-----------------------+----------+-------+-------------------+--------------------+
| 1             | 1997-03-01  | Saturday     | Y        | 7                   | 1                    | 60                  | 9921                | 9                    | 1418                 | March       | 3                     | 327                   | 1        | 1997  | Q1CY97            | 1997-02-23         |
| 2             | 1997-03-02  | Sunday       | Y        | 1                   | 2                    | 61                  | 9922                | 10                   | 1418                 | March       | 3                     | 327                   | 1        | 1997  | Q1CY97            | 1997-03-02         |
+---------------+-------------+--------------+----------+---------------------+----------------------+---------------------+---------------------+----------------------+----------------------+-------------+-----------------------+-----------------------+----------+-------+-------------------+--------------------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from 
. . . . . . . . > (select * from table(applib.time_dimension(2060, 1, 31, 2060, 2, 1)))
. . . . . . . . > order by time_key_seq;
+---------------+-------------+--------------+----------+---------------------+----------------------+---------------------+---------------------+----------------------+----------------------+-------------+-----------------------+-----------------------+----------+-------+-------------------+--------------------+
| TIME_KEY_SEQ  |  TIME_KEY   | DAY_OF_WEEK  | WEEKEND  | DAY_NUMBER_IN_WEEK  | DAY_NUMBER_IN_MONTH  | DAY_NUMBER_IN_YEAR  | DAY_NUMBER_OVERALL  | WEEK_NUMBER_IN_YEAR  | WEEK_NUMBER_OVERALL  | MONTH_NAME  | MONTH_NUMBER_IN_YEAR  | MONTH_NUMBER_OVERALL  | QUARTER  |  YR   | CALENDAR_QUARTER  | FIRST_DAY_OF_WEEK  |
+---------------+-------------+--------------+----------+---------------------+----------------------+---------------------+---------------------+----------------------+----------------------+-------------+-----------------------+-----------------------+----------+-------+-------------------+--------------------+
| 1             | 2060-01-31  | Saturday     | Y        | 7                   | 31                   | 31                  | 32902               | 5                    | 4701                 | January     | 1                     | 1081                  | 1        | 2060  | Q1CY60            | 2060-01-25         |
| 2             | 2060-02-01  | Sunday       | Y        | 1                   | 1                    | 32                  | 32903               | 6                    | 4701                 | February    | 2                     | 1082                  | 1        | 2060  | Q1CY60            | 2060-02-01         |
+---------------+-------------+--------------+----------+---------------------+----------------------+---------------------+---------------------+----------------------+----------------------+-------------+-----------------------+-----------------------+----------+-------+-------------------+--------------------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- Negative tests
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from table(applib.time_dimension(1997, 3, 1, 1997, 2, 1));
Error: Start day must precede end day (state=,code=0)
0: jdbc:luciddb:> select * from table(applib.time_dimension( 1994, 1, 1, 1993, 1, 1)); 
Error: Start day must precede end day (state=,code=0)
0: jdbc:luciddb:> select * from table(applib.time_dimension( 1994, -1, 1, 1995, 1, 1));
Error: Invalid start date (state=,code=0)
0: jdbc:luciddb:> select * from table(applib.time_dimension( 1994, 1, -1, 1995, 1, 1 ));
Error: Invalid start date (state=,code=0)
0: jdbc:luciddb:> select * from table(applib.time_dimension( 1994, 1, 1, 1995, -1, 1 ));
Error: Invalid end date (state=,code=0)
0: jdbc:luciddb:> select * from table(applib.time_dimension( 1994, 1, 1, 1995, 1, -1 ));
Error: Invalid end date (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- Time functions
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select 
. . . . . . . . >  time_key, 
. . . . . . . . >  applib.calendar_quarter( time_key ), 
. . . . . . . . >  applib.fiscal_quarter( time_key, 4 ), 
. . . . . . . . >  applib.fiscal_month( time_key, 4 ), 
. . . . . . . . >  applib.fiscal_year( time_key, 4 )
. . . . . . . . > from table(applib.time_dimension( 1821, 11, 29, 1821, 12, 1 ))
. . . . . . . . > order by time_key;
+-------------+---------+---------+---------+---------+
|  TIME_KEY   | EXPR$1  | EXPR$2  | EXPR$3  | EXPR$4  |
+-------------+---------+---------+---------+---------+
| 1821-11-29  | Q4CY21  | Q3FY22  | 8       | 1822    |
| 1821-11-30  | Q4CY21  | Q3FY22  | 8       | 1822    |
| 1821-12-01  | Q4CY21  | Q3FY22  | 9       | 1822    |
+-------------+---------+---------+---------+---------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- Negative tests
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select time_key, applib.fiscal_quarter( time_key, 0 ) 
. . . . . . . . > from table(applib.time_dimension( 1994, 1, 1, 1994, 1, 1 ));
Error: First month must be between 1 and 12 (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select time_key, applib.fiscal_quarter( time_key, 13 ) 
. . . . . . . . > from table(applib.time_dimension( 1994, 1, 1, 1994, 1, 1 ));
Error: First month must be between 1 and 12 (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select time_key, applib.fiscal_month( time_key, 0 ) 
. . . . . . . . > from table(applib.time_dimension( 1994, 1, 1, 1994, 1, 1 ));
Error: First month must be between 1 and 12 (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select time_key, applib.fiscal_month( time_key, 13 ) 
. . . . . . . . > from table(applib.time_dimension( 1994, 1, 1, 1994, 1, 1 ));
Error: First month must be between 1 and 12 (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select time_key, applib.fiscal_year( time_key, 0 ) 
. . . . . . . . > from table(applib.time_dimension( 1994, 1, 1, 1994, 1, 1 ));
Error: First month must be between 1 and 12 (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select time_key, applib.fiscal_year( time_key, 13 ) 
. . . . . . . . > from table(applib.time_dimension( 1994, 1, 1, 1994, 1, 1 ));
Error: First month must be between 1 and 12 (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- create views w/ reference to time_dimension
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create view td1 as
. . . . . . . . > select * 
. . . . . . . . > from table(applib.time_dimension(1997, 1, 1, 1997, 2, 1));
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from td1;
+---------------+-------------+--------------+----------+---------------------+----------------------+---------------------+---------------------+----------------------+----------------------+-------------+-----------------------+-----------------------+----------+-------+-------------------+--------------------+
| TIME_KEY_SEQ  |  TIME_KEY   | DAY_OF_WEEK  | WEEKEND  | DAY_NUMBER_IN_WEEK  | DAY_NUMBER_IN_MONTH  | DAY_NUMBER_IN_YEAR  | DAY_NUMBER_OVERALL  | WEEK_NUMBER_IN_YEAR  | WEEK_NUMBER_OVERALL  | MONTH_NAME  | MONTH_NUMBER_IN_YEAR  | MONTH_NUMBER_OVERALL  | QUARTER  |  YR   | CALENDAR_QUARTER  | FIRST_DAY_OF_WEEK  |
+---------------+-------------+--------------+----------+---------------------+----------------------+---------------------+---------------------+----------------------+----------------------+-------------+-----------------------+-----------------------+----------+-------+-------------------+--------------------+
| 1             | 1997-01-01  | Wednesday    | N        | 4                   | 1                    | 1                   | 9862                | 1                    | 1409                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1996-12-29         |
| 2             | 1997-01-02  | Thursday     | N        | 5                   | 2                    | 2                   | 9863                | 1                    | 1410                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1996-12-29         |
| 3             | 1997-01-03  | Friday       | N        | 6                   | 3                    | 3                   | 9864                | 1                    | 1410                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1996-12-29         |
| 4             | 1997-01-04  | Saturday     | Y        | 7                   | 4                    | 4                   | 9865                | 1                    | 1410                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1996-12-29         |
| 5             | 1997-01-05  | Sunday       | Y        | 1                   | 5                    | 5                   | 9866                | 2                    | 1410                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-05         |
| 6             | 1997-01-06  | Monday       | N        | 2                   | 6                    | 6                   | 9867                | 2                    | 1410                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-05         |
| 7             | 1997-01-07  | Tuesday      | N        | 3                   | 7                    | 7                   | 9868                | 2                    | 1410                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-05         |
| 8             | 1997-01-08  | Wednesday    | N        | 4                   | 8                    | 8                   | 9869                | 2                    | 1410                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-05         |
| 9             | 1997-01-09  | Thursday     | N        | 5                   | 9                    | 9                   | 9870                | 2                    | 1411                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-05         |
| 10            | 1997-01-10  | Friday       | N        | 6                   | 10                   | 10                  | 9871                | 2                    | 1411                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-05         |
| 11            | 1997-01-11  | Saturday     | Y        | 7                   | 11                   | 11                  | 9872                | 2                    | 1411                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-05         |
| 12            | 1997-01-12  | Sunday       | Y        | 1                   | 12                   | 12                  | 9873                | 3                    | 1411                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-12         |
| 13            | 1997-01-13  | Monday       | N        | 2                   | 13                   | 13                  | 9874                | 3                    | 1411                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-12         |
| 14            | 1997-01-14  | Tuesday      | N        | 3                   | 14                   | 14                  | 9875                | 3                    | 1411                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-12         |
| 15            | 1997-01-15  | Wednesday    | N        | 4                   | 15                   | 15                  | 9876                | 3                    | 1411                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-12         |
| 16            | 1997-01-16  | Thursday     | N        | 5                   | 16                   | 16                  | 9877                | 3                    | 1412                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-12         |
| 17            | 1997-01-17  | Friday       | N        | 6                   | 17                   | 17                  | 9878                | 3                    | 1412                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-12         |
| 18            | 1997-01-18  | Saturday     | Y        | 7                   | 18                   | 18                  | 9879                | 3                    | 1412                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-12         |
| 19            | 1997-01-19  | Sunday       | Y        | 1                   | 19                   | 19                  | 9880                | 4                    | 1412                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-19         |
| 20            | 1997-01-20  | Monday       | N        | 2                   | 20                   | 20                  | 9881                | 4                    | 1412                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-19         |
| 21            | 1997-01-21  | Tuesday      | N        | 3                   | 21                   | 21                  | 9882                | 4                    | 1412                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-19         |
| 22            | 1997-01-22  | Wednesday    | N        | 4                   | 22                   | 22                  | 9883                | 4                    | 1412                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-19         |
| 23            | 1997-01-23  | Thursday     | N        | 5                   | 23                   | 23                  | 9884                | 4                    | 1413                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-19         |
| 24            | 1997-01-24  | Friday       | N        | 6                   | 24                   | 24                  | 9885                | 4                    | 1413                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-19         |
| 25            | 1997-01-25  | Saturday     | Y        | 7                   | 25                   | 25                  | 9886                | 4                    | 1413                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-19         |
| 26            | 1997-01-26  | Sunday       | Y        | 1                   | 26                   | 26                  | 9887                | 5                    | 1413                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-26         |
| 27            | 1997-01-27  | Monday       | N        | 2                   | 27                   | 27                  | 9888                | 5                    | 1413                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-26         |
| 28            | 1997-01-28  | Tuesday      | N        | 3                   | 28                   | 28                  | 9889                | 5                    | 1413                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-26         |
| 29            | 1997-01-29  | Wednesday    | N        | 4                   | 29                   | 29                  | 9890                | 5                    | 1413                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-26         |
| 30            | 1997-01-30  | Thursday     | N        | 5                   | 30                   | 30                  | 9891                | 5                    | 1414                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-26         |
| 31            | 1997-01-31  | Friday       | N        | 6                   | 31                   | 31                  | 9892                | 5                    | 1414                 | January     | 1                     | 325                   | 1        | 1997  | Q1CY97            | 1997-01-26         |
| 32            | 1997-02-01  | Saturday     | Y        | 7                   | 1                    | 32                  | 9893                | 5                    | 1414                 | February    | 2                     | 326                   | 1        | 1997  | Q1CY97            | 1997-01-26         |
+---------------+-------------+--------------+----------+---------------------+----------------------+---------------------+---------------------+----------------------+----------------------+-------------+-----------------------+-----------------------+----------+-------+-------------------+--------------------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table udxtest.period (
. . . . . . . . > time_key_seq integer,
. . . . . . . . > time_key date,
. . . . . . . . > quarter integer,
. . . . . . . . > yr integer,
. . . . . . . . > calendar_quarter varchar(15) );
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into udxtest.period
. . . . . . . . > select 
. . . . . . . . > g_period.time_key_seq,
. . . . . . . . > g_period.time_key,
. . . . . . . . > g_period.quarter,
. . . . . . . . > g_period.yr,
. . . . . . . . > g_period.calendar_quarter
. . . . . . . . > from
. . . . . . . . > (select * from table(applib.time_dimension(1996, 5, 1, 1996, 5, 31)))g_period;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from udxtest.period
. . . . . . . . > order by 1;
+---------------+-------------+----------+-------+-------------------+
| TIME_KEY_SEQ  |  TIME_KEY   | QUARTER  |  YR   | CALENDAR_QUARTER  |
+---------------+-------------+----------+-------+-------------------+
| 1             | 1996-05-01  | 2        | 1996  | Q2CY96            |
| 2             | 1996-05-02  | 2        | 1996  | Q2CY96            |
| 3             | 1996-05-03  | 2        | 1996  | Q2CY96            |
| 4             | 1996-05-04  | 2        | 1996  | Q2CY96            |
| 5             | 1996-05-05  | 2        | 1996  | Q2CY96            |
| 6             | 1996-05-06  | 2        | 1996  | Q2CY96            |
| 7             | 1996-05-07  | 2        | 1996  | Q2CY96            |
| 8             | 1996-05-08  | 2        | 1996  | Q2CY96            |
| 9             | 1996-05-09  | 2        | 1996  | Q2CY96            |
| 10            | 1996-05-10  | 2        | 1996  | Q2CY96            |
| 11            | 1996-05-11  | 2        | 1996  | Q2CY96            |
| 12            | 1996-05-12  | 2        | 1996  | Q2CY96            |
| 13            | 1996-05-13  | 2        | 1996  | Q2CY96            |
| 14            | 1996-05-14  | 2        | 1996  | Q2CY96            |
| 15            | 1996-05-15  | 2        | 1996  | Q2CY96            |
| 16            | 1996-05-16  | 2        | 1996  | Q2CY96            |
| 17            | 1996-05-17  | 2        | 1996  | Q2CY96            |
| 18            | 1996-05-18  | 2        | 1996  | Q2CY96            |
| 19            | 1996-05-19  | 2        | 1996  | Q2CY96            |
| 20            | 1996-05-20  | 2        | 1996  | Q2CY96            |
| 21            | 1996-05-21  | 2        | 1996  | Q2CY96            |
| 22            | 1996-05-22  | 2        | 1996  | Q2CY96            |
| 23            | 1996-05-23  | 2        | 1996  | Q2CY96            |
| 24            | 1996-05-24  | 2        | 1996  | Q2CY96            |
| 25            | 1996-05-25  | 2        | 1996  | Q2CY96            |
| 26            | 1996-05-26  | 2        | 1996  | Q2CY96            |
| 27            | 1996-05-27  | 2        | 1996  | Q2CY96            |
| 28            | 1996-05-28  | 2        | 1996  | Q2CY96            |
| 29            | 1996-05-29  | 2        | 1996  | Q2CY96            |
| 30            | 1996-05-30  | 2        | 1996  | Q2CY96            |
| 31            | 1996-05-31  | 2        | 1996  | Q2CY96            |
+---------------+-------------+----------+-------+-------------------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into udxtest.period
. . . . . . . . > select
. . . . . . . . > t_period.time_key_seq,
. . . . . . . . > t_period.time_key,
. . . . . . . . > t_period.quarter,
. . . . . . . . > t_period.yr,
. . . . . . . . > t_period.calendar_quarter
. . . . . . . . > from
. . . . . . . . > (select * from table(applib.time_dimension(1996, 5, 12, 1996, 6, 2)))t_period;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select period.time_key, count(period.time_key_seq)
. . . . . . . . > from period
. . . . . . . . > group by period.time_key
. . . . . . . . > having count(period.time_key_seq) > 1
. . . . . . . . > order by 1;
+-------------+---------+
|  TIME_KEY   | EXPR$1  |
+-------------+---------+
| 1996-05-12  | 2       |
| 1996-05-13  | 2       |
| 1996-05-14  | 2       |
| 1996-05-15  | 2       |
| 1996-05-16  | 2       |
| 1996-05-17  | 2       |
| 1996-05-18  | 2       |
| 1996-05-19  | 2       |
| 1996-05-20  | 2       |
| 1996-05-21  | 2       |
| 1996-05-22  | 2       |
| 1996-05-23  | 2       |
| 1996-05-24  | 2       |
| 1996-05-25  | 2       |
| 1996-05-26  | 2       |
| 1996-05-27  | 2       |
| 1996-05-28  | 2       |
| 1996-05-29  | 2       |
| 1996-05-30  | 2       |
| 1996-05-31  | 2       |
+-------------+---------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- check no multiple records for certain dates
0: jdbc:luciddb:> select periods.time_key, count(periods.time_key_seq)
. . . . . . . . > from 
. . . . . . . . > (select * from table(applib.time_dimension(1900, 1, 1, 2010, 12, 31)))periods
. . . . . . . . > group by periods.time_key
. . . . . . . . > having count(periods.time_key_seq) > 1
. . . . . . . . > order by 1;
+-----------+---------+
| TIME_KEY  | EXPR$1  |
+-----------+---------+
+-----------+---------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> !quit
