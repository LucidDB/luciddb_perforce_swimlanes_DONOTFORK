0: jdbc:luciddb:> create schema flatten;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> set schema 'flatten';
0: jdbc:luciddb:> 
0: jdbc:luciddb:> --------------------
0: jdbc:luciddb:> -- positive tests --
0: jdbc:luciddb:> --------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- simple tree (no multiple path) ------------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table tree1(parent varchar(128), child varchar(128));
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into tree1 values
. . . . . . . . >     ('01','02'),
. . . . . . . . >     ('01','03'),
. . . . . . . . >     ('01','04'),
. . . . . . . . >     ('02','05'),
. . . . . . . . >     ('02','06'),
. . . . . . . . >     ('07','08'),
. . . . . . . . >     ('08','09'),
. . . . . . . . >     ('08','10'),
. . . . . . . . >     ('09','11'),
. . . . . . . . >     ('11','12'),
. . . . . . . . >     ('11','13')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * 
. . . . . . . . > from table(applib.flatten_recursive_hierarchy(cursor(select * from tree1)));
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| VERTICES  | MULTIPATH  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 2         | false      | 01      | 03      | 03      | 03      | 03      | 03      | 03      | 03      | 03      | 03       | 03       | 03       | 03       | 03       | 03       |
| 2         | false      | 01      | 04      | 04      | 04      | 04      | 04      | 04      | 04      | 04      | 04       | 04       | 04       | 04       | 04       | 04       |
| 3         | false      | 01      | 02      | 05      | 05      | 05      | 05      | 05      | 05      | 05      | 05       | 05       | 05       | 05       | 05       | 05       |
| 3         | false      | 01      | 02      | 06      | 06      | 06      | 06      | 06      | 06      | 06      | 06       | 06       | 06       | 06       | 06       | 06       |
| 3         | false      | 07      | 08      | 10      | 10      | 10      | 10      | 10      | 10      | 10      | 10       | 10       | 10       | 10       | 10       | 10       |
| 5         | false      | 07      | 08      | 09      | 11      | 12      | 12      | 12      | 12      | 12      | 12       | 12       | 12       | 12       | 12       | 12       |
| 5         | false      | 07      | 08      | 09      | 11      | 13      | 13      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * 
. . . . . . . . > from table(applib.flatten_recursive_hierarchy_all_levels(cursor(
. . . . . . . . >     select * from tree1)));
+-----------+------------+-----------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| VERTICES  | MULTIPATH  | NON_LEAF  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+-----------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 2         | false      | true      | 01      | 02      | 02      | 02      | 02      | 02      | 02      | 02      | 02      | 02       | 02       | 02       | 02       | 02       | 02       |
| 1         | false      | true      | 01      | 01      | 01      | 01      | 01      | 01      | 01      | 01      | 01      | 01       | 01       | 01       | 01       | 01       | 01       |
| 2         | false      | false     | 01      | 03      | 03      | 03      | 03      | 03      | 03      | 03      | 03      | 03       | 03       | 03       | 03       | 03       | 03       |
| 2         | false      | false     | 01      | 04      | 04      | 04      | 04      | 04      | 04      | 04      | 04      | 04       | 04       | 04       | 04       | 04       | 04       |
| 3         | false      | false     | 01      | 02      | 05      | 05      | 05      | 05      | 05      | 05      | 05      | 05       | 05       | 05       | 05       | 05       | 05       |
| 3         | false      | false     | 01      | 02      | 06      | 06      | 06      | 06      | 06      | 06      | 06      | 06       | 06       | 06       | 06       | 06       | 06       |
| 2         | false      | true      | 07      | 08      | 08      | 08      | 08      | 08      | 08      | 08      | 08      | 08       | 08       | 08       | 08       | 08       | 08       |
| 1         | false      | true      | 07      | 07      | 07      | 07      | 07      | 07      | 07      | 07      | 07      | 07       | 07       | 07       | 07       | 07       | 07       |
| 3         | false      | true      | 07      | 08      | 09      | 09      | 09      | 09      | 09      | 09      | 09      | 09       | 09       | 09       | 09       | 09       | 09       |
| 3         | false      | false     | 07      | 08      | 10      | 10      | 10      | 10      | 10      | 10      | 10      | 10       | 10       | 10       | 10       | 10       | 10       |
| 4         | false      | true      | 07      | 08      | 09      | 11      | 11      | 11      | 11      | 11      | 11      | 11       | 11       | 11       | 11       | 11       | 11       |
| 5         | false      | false     | 07      | 08      | 09      | 11      | 12      | 12      | 12      | 12      | 12      | 12       | 12       | 12       | 12       | 12       | 12       |
| 5         | false      | false     | 07      | 08      | 09      | 11      | 13      | 13      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
+-----------+------------+-----------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- graph with multiple paths -----------------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table mgraph(parent varchar(128), child varchar(128));
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into mgraph values
. . . . . . . . >     ('01','02'),
. . . . . . . . >     ('01','03'),
. . . . . . . . >     ('02','04'),
. . . . . . . . >     ('03','04'),
. . . . . . . . >     ('04','05'),
. . . . . . . . >     ('04','06'),
. . . . . . . . >     ('05','07'),
. . . . . . . . >     ('06','07'),
. . . . . . . . >     ('01','07'),
. . . . . . . . >     ('01','08')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * 
. . . . . . . . > from table(applib.flatten_recursive_hierarchy(cursor(select * from mgraph)));
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| VERTICES  | MULTIPATH  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 2         | true       | 01      | 07      | 07      | 07      | 07      | 07      | 07      | 07      | 07      | 07       | 07       | 07       | 07       | 07       | 07       |
| 5         | true       | 01      | 03      | 04      | 06      | 07      | 07      | 07      | 07      | 07      | 07       | 07       | 07       | 07       | 07       | 07       |
| 5         | true       | 01      | 02      | 04      | 06      | 07      | 07      | 07      | 07      | 07      | 07       | 07       | 07       | 07       | 07       | 07       |
| 5         | true       | 01      | 03      | 04      | 05      | 07      | 07      | 07      | 07      | 07      | 07       | 07       | 07       | 07       | 07       | 07       |
| 5         | true       | 01      | 02      | 04      | 05      | 07      | 07      | 07      | 07      | 07      | 07       | 07       | 07       | 07       | 07       | 07       |
| 2         | false      | 01      | 08      | 08      | 08      | 08      | 08      | 08      | 08      | 08      | 08       | 08       | 08       | 08       | 08       | 08       |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * 
. . . . . . . . > from table(applib.flatten_recursive_hierarchy_all_levels(cursor(
. . . . . . . . >     select * from mgraph)));
+-----------+------------+-----------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| VERTICES  | MULTIPATH  | NON_LEAF  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+-----------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 2         | false      | true      | 01      | 02      | 02      | 02      | 02      | 02      | 02      | 02      | 02      | 02       | 02       | 02       | 02       | 02       | 02       |
| 1         | false      | true      | 01      | 01      | 01      | 01      | 01      | 01      | 01      | 01      | 01      | 01       | 01       | 01       | 01       | 01       | 01       |
| 2         | false      | true      | 01      | 03      | 03      | 03      | 03      | 03      | 03      | 03      | 03      | 03       | 03       | 03       | 03       | 03       | 03       |
| 3         | true       | true      | 01      | 03      | 04      | 04      | 04      | 04      | 04      | 04      | 04      | 04       | 04       | 04       | 04       | 04       | 04       |
| 3         | true       | true      | 01      | 02      | 04      | 04      | 04      | 04      | 04      | 04      | 04      | 04       | 04       | 04       | 04       | 04       | 04       |
| 4         | true       | true      | 01      | 03      | 04      | 05      | 05      | 05      | 05      | 05      | 05      | 05       | 05       | 05       | 05       | 05       | 05       |
| 4         | true       | true      | 01      | 02      | 04      | 05      | 05      | 05      | 05      | 05      | 05      | 05       | 05       | 05       | 05       | 05       | 05       |
| 4         | true       | true      | 01      | 03      | 04      | 06      | 06      | 06      | 06      | 06      | 06      | 06       | 06       | 06       | 06       | 06       | 06       |
| 4         | true       | true      | 01      | 02      | 04      | 06      | 06      | 06      | 06      | 06      | 06      | 06       | 06       | 06       | 06       | 06       | 06       |
| 2         | true       | false     | 01      | 07      | 07      | 07      | 07      | 07      | 07      | 07      | 07      | 07       | 07       | 07       | 07       | 07       | 07       |
| 5         | true       | false     | 01      | 03      | 04      | 06      | 07      | 07      | 07      | 07      | 07      | 07       | 07       | 07       | 07       | 07       | 07       |
| 5         | true       | false     | 01      | 02      | 04      | 06      | 07      | 07      | 07      | 07      | 07      | 07       | 07       | 07       | 07       | 07       | 07       |
| 5         | true       | false     | 01      | 03      | 04      | 05      | 07      | 07      | 07      | 07      | 07      | 07       | 07       | 07       | 07       | 07       | 07       |
| 5         | true       | false     | 01      | 02      | 04      | 05      | 07      | 07      | 07      | 07      | 07      | 07       | 07       | 07       | 07       | 07       | 07       |
| 2         | false      | false     | 01      | 08      | 08      | 08      | 08      | 08      | 08      | 08      | 08      | 08       | 08       | 08       | 08       | 08       | 08       |
+-----------+------------+-----------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> truncate table mgraph;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into mgraph values
. . . . . . . . >     ('01','04'),
. . . . . . . . >     ('00','04'),
. . . . . . . . >     ('01','02'),
. . . . . . . . >     ('02','03'),
. . . . . . . . >     ('03','04'),
. . . . . . . . >     ('04','05'),
. . . . . . . . >     ('06','04'),
. . . . . . . . >     ('02','06'),
. . . . . . . . >     ('01','07'),
. . . . . . . . >     ('07','08'),
. . . . . . . . >     ('07','09'),
. . . . . . . . >     ('05','10'),
. . . . . . . . >     ('05','11'),
. . . . . . . . >     ('09','11'),
. . . . . . . . >     ('11','12'),
. . . . . . . . >     ('11','13'),
. . . . . . . . >     ('10','12'),
. . . . . . . . >     ('12','14')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * 
. . . . . . . . > from table(applib.flatten_recursive_hierarchy(cursor(select * from mgraph)));
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| VERTICES  | MULTIPATH  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 3         | false      | 01      | 07      | 08      | 08      | 08      | 08      | 08      | 08      | 08      | 08       | 08       | 08       | 08       | 08       | 08       |
| 5         | true       | 01      | 07      | 09      | 11      | 13      | 13      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 7         | true       | 01      | 02      | 06      | 04      | 05      | 11      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 7         | true       | 01      | 02      | 03      | 04      | 05      | 11      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 5         | true       | 00      | 04      | 05      | 11      | 13      | 13      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 5         | true       | 01      | 04      | 05      | 11      | 13      | 13      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 8         | true       | 01      | 02      | 06      | 04      | 05      | 10      | 12      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 8         | true       | 01      | 02      | 03      | 04      | 05      | 10      | 12      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 6         | true       | 00      | 04      | 05      | 10      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 6         | true       | 01      | 04      | 05      | 10      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 6         | true       | 01      | 07      | 09      | 11      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 8         | true       | 01      | 02      | 06      | 04      | 05      | 11      | 12      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 8         | true       | 01      | 02      | 03      | 04      | 05      | 11      | 12      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 6         | true       | 00      | 04      | 05      | 11      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 6         | true       | 01      | 04      | 05      | 11      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- input table has null values at col 1 for root nodes----------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table nullval(c1 varchar(10), c2 varchar(10));
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into nullval values
. . . . . . . . >     (null, '00'),
. . . . . . . . >     (null, '01'),
. . . . . . . . >     ('02', '03'),
. . . . . . . . >     (null, '02'),
. . . . . . . . >     ('02', '04'),
. . . . . . . . >     ('03', '04'),
. . . . . . . . >     ('04', '05'),
. . . . . . . . >     ('04', '06'),
. . . . . . . . >     ('02', '07'),
. . . . . . . . >     ('07', '08'),
. . . . . . . . >     ('08', '09'),
. . . . . . . . >     ('09', '10'),
. . . . . . . . >     ('07', '11'),
. . . . . . . . >     ('11', '12')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * 
. . . . . . . . > from table (applib.flatten_recursive_hierarchy(cursor(select * from nullval)));
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| VERTICES  | MULTIPATH  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 1         | false      | 00      | 00      | 00      | 00      | 00      | 00      | 00      | 00      | 00      | 00       | 00       | 00       | 00       | 00       | 00       |
| 1         | false      | 01      | 01      | 01      | 01      | 01      | 01      | 01      | 01      | 01      | 01       | 01       | 01       | 01       | 01       | 01       |
| 4         | true       | 02      | 03      | 04      | 05      | 05      | 05      | 05      | 05      | 05      | 05       | 05       | 05       | 05       | 05       | 05       |
| 3         | true       | 02      | 04      | 05      | 05      | 05      | 05      | 05      | 05      | 05      | 05       | 05       | 05       | 05       | 05       | 05       |
| 4         | true       | 02      | 03      | 04      | 06      | 06      | 06      | 06      | 06      | 06      | 06       | 06       | 06       | 06       | 06       | 06       |
| 3         | true       | 02      | 04      | 06      | 06      | 06      | 06      | 06      | 06      | 06      | 06       | 06       | 06       | 06       | 06       | 06       |
| 5         | false      | 02      | 07      | 08      | 09      | 10      | 10      | 10      | 10      | 10      | 10       | 10       | 10       | 10       | 10       | 10       |
| 4         | false      | 02      | 07      | 11      | 12      | 12      | 12      | 12      | 12      | 12      | 12       | 12       | 12       | 12       | 12       | 12       |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> truncate table nullval;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into nullval values 
. . . . . . . . >     ('01','04'),
. . . . . . . . >     (null, '00'),
. . . . . . . . >     ('00','04'),
. . . . . . . . >     ('01','02'),
. . . . . . . . >     ('02','03'),
. . . . . . . . >     (null, '01'),
. . . . . . . . >     ('03','04'),
. . . . . . . . >     ('04','05'),
. . . . . . . . >     ('06','04'),
. . . . . . . . >     ('02','06'),
. . . . . . . . >     ('01','07'),
. . . . . . . . >     ('07','08'),
. . . . . . . . >     ('07','09'),
. . . . . . . . >     ('05','10'),
. . . . . . . . >     ('05','11'),
. . . . . . . . >     ('09','11'),
. . . . . . . . >     ('11','12'),
. . . . . . . . >     ('11','13'),
. . . . . . . . >     ('10','12'),
. . . . . . . . >     ('12','14')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * 
. . . . . . . . > from table (applib.flatten_recursive_hierarchy(cursor(select * from nullval)));
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| VERTICES  | MULTIPATH  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 3         | false      | 01      | 07      | 08      | 08      | 08      | 08      | 08      | 08      | 08      | 08       | 08       | 08       | 08       | 08       | 08       |
| 5         | true       | 01      | 07      | 09      | 11      | 13      | 13      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 7         | true       | 01      | 02      | 06      | 04      | 05      | 11      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 7         | true       | 01      | 02      | 03      | 04      | 05      | 11      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 5         | true       | 00      | 04      | 05      | 11      | 13      | 13      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 5         | true       | 01      | 04      | 05      | 11      | 13      | 13      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 8         | true       | 01      | 02      | 06      | 04      | 05      | 10      | 12      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 8         | true       | 01      | 02      | 03      | 04      | 05      | 10      | 12      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 6         | true       | 00      | 04      | 05      | 10      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 6         | true       | 01      | 04      | 05      | 10      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 6         | true       | 01      | 07      | 09      | 11      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 8         | true       | 01      | 02      | 06      | 04      | 05      | 11      | 12      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 8         | true       | 01      | 02      | 03      | 04      | 05      | 11      | 12      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 6         | true       | 00      | 04      | 05      | 11      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 6         | true       | 01      | 04      | 05      | 11      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- input table has non-string type -----------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table typeint(parent int, child int);
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into typeint values
. . . . . . . . >     (null,1),
. . . . . . . . >     (null,2),
. . . . . . . . >     (2,3),
. . . . . . . . >     (2,4),
. . . . . . . . >     (2,5),
. . . . . . . . >     (5,6),
. . . . . . . . >     (2,6),
. . . . . . . . >     (6,7)
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * 
. . . . . . . . > from table (applib.flatten_recursive_hierarchy(cursor(select * from typeint)));
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| VERTICES  | MULTIPATH  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 1         | false      | 1       | 1       | 1       | 1       | 1       | 1       | 1       | 1       | 1       | 1        | 1        | 1        | 1        | 1        | 1        |
| 2         | false      | 2       | 3       | 3       | 3       | 3       | 3       | 3       | 3       | 3       | 3        | 3        | 3        | 3        | 3        | 3        |
| 2         | false      | 2       | 4       | 4       | 4       | 4       | 4       | 4       | 4       | 4       | 4        | 4        | 4        | 4        | 4        | 4        |
| 3         | true       | 2       | 6       | 7       | 7       | 7       | 7       | 7       | 7       | 7       | 7        | 7        | 7        | 7        | 7        | 7        |
| 4         | true       | 2       | 5       | 6       | 7       | 7       | 7       | 7       | 7       | 7       | 7        | 7        | 7        | 7        | 7        | 7        |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table typedouble(parent double, child double);
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into typedouble values
. . . . . . . . >     (null,1.0),
. . . . . . . . >     (null,2.0),
. . . . . . . . >     (2.0,3.0),
. . . . . . . . >     (2.0,4.0),
. . . . . . . . >     (2.0,5.0),
. . . . . . . . >     (5.0,6.0),
. . . . . . . . >     (2.0,6.0),
. . . . . . . . >     (6.0,7.0)
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * 
. . . . . . . . > from table (applib.flatten_recursive_hierarchy(cursor(select * from typedouble)));
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| VERTICES  | MULTIPATH  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 1         | false      | 1.0     | 1.0     | 1.0     | 1.0     | 1.0     | 1.0     | 1.0     | 1.0     | 1.0     | 1.0      | 1.0      | 1.0      | 1.0      | 1.0      | 1.0      |
| 2         | false      | 2.0     | 3.0     | 3.0     | 3.0     | 3.0     | 3.0     | 3.0     | 3.0     | 3.0     | 3.0      | 3.0      | 3.0      | 3.0      | 3.0      | 3.0      |
| 2         | false      | 2.0     | 4.0     | 4.0     | 4.0     | 4.0     | 4.0     | 4.0     | 4.0     | 4.0     | 4.0      | 4.0      | 4.0      | 4.0      | 4.0      | 4.0      |
| 3         | true       | 2.0     | 6.0     | 7.0     | 7.0     | 7.0     | 7.0     | 7.0     | 7.0     | 7.0     | 7.0      | 7.0      | 7.0      | 7.0      | 7.0      | 7.0      |
| 4         | true       | 2.0     | 5.0     | 6.0     | 7.0     | 7.0     | 7.0     | 7.0     | 7.0     | 7.0     | 7.0      | 7.0      | 7.0      | 7.0      | 7.0      | 7.0      |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table typetimestamp(parent timestamp, child timestamp);
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into typetimestamp values
. . . . . . . . >     (null,timestamp'2002-01-01 01:56:00'),
. . . . . . . . >     (null,timestamp'2002-01-02 01:56:00'),
. . . . . . . . >     (timestamp'2002-01-02 01:56:00',timestamp'2002-01-03 01:56:00'),
. . . . . . . . >     (timestamp'2002-01-02 01:56:00',timestamp'2002-01-04 01:56:00'),
. . . . . . . . >     (timestamp'2002-01-02 01:56:00',timestamp'2002-01-05 01:56:00'),
. . . . . . . . >     (timestamp'2002-01-05 01:56:00',timestamp'2002-01-06 01:56:00'),
. . . . . . . . >     (timestamp'2002-01-02 01:56:00',timestamp'2002-01-06 01:56:00'),
. . . . . . . . >     (timestamp'2002-01-06 01:56:00',timestamp'2002-01-07 01:56:00')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * 
. . . . . . . . > from table (applib.flatten_recursive_hierarchy(cursor(select * from typetimestamp)));
+-----------+------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+
| VERTICES  | MULTIPATH  |        LEVEL1        |        LEVEL2        |        LEVEL3        |        LEVEL4        |        LEVEL5        |        LEVEL6        |        LEVEL7        |        LEVEL8        |        LEVEL9        |       LEVEL10        |       LEVEL11        |       LEVEL12        |       LEVEL13        |       LEVEL14        |       LEVEL15        |
+-----------+------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+
| 1         | false      | 2002-01-01 01:56:00  | 2002-01-01 01:56:00  | 2002-01-01 01:56:00  | 2002-01-01 01:56:00  | 2002-01-01 01:56:00  | 2002-01-01 01:56:00  | 2002-01-01 01:56:00  | 2002-01-01 01:56:00  | 2002-01-01 01:56:00  | 2002-01-01 01:56:00  | 2002-01-01 01:56:00  | 2002-01-01 01:56:00  | 2002-01-01 01:56:00  | 2002-01-01 01:56:00  | 2002-01-01 01:56:00  |
| 2         | false      | 2002-01-02 01:56:00  | 2002-01-03 01:56:00  | 2002-01-03 01:56:00  | 2002-01-03 01:56:00  | 2002-01-03 01:56:00  | 2002-01-03 01:56:00  | 2002-01-03 01:56:00  | 2002-01-03 01:56:00  | 2002-01-03 01:56:00  | 2002-01-03 01:56:00  | 2002-01-03 01:56:00  | 2002-01-03 01:56:00  | 2002-01-03 01:56:00  | 2002-01-03 01:56:00  | 2002-01-03 01:56:00  |
| 2         | false      | 2002-01-02 01:56:00  | 2002-01-04 01:56:00  | 2002-01-04 01:56:00  | 2002-01-04 01:56:00  | 2002-01-04 01:56:00  | 2002-01-04 01:56:00  | 2002-01-04 01:56:00  | 2002-01-04 01:56:00  | 2002-01-04 01:56:00  | 2002-01-04 01:56:00  | 2002-01-04 01:56:00  | 2002-01-04 01:56:00  | 2002-01-04 01:56:00  | 2002-01-04 01:56:00  | 2002-01-04 01:56:00  |
| 3         | true       | 2002-01-02 01:56:00  | 2002-01-06 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  |
| 4         | true       | 2002-01-02 01:56:00  | 2002-01-05 01:56:00  | 2002-01-06 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  | 2002-01-07 01:56:00  |
+-----------+------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+----------------------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- tree as deep as maxDepth------------------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table deep15(parent varchar(128), child varchar(128));
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into deep15 values
. . . . . . . . >     ('a','b'),
. . . . . . . . >     ('a','c'),
. . . . . . . . >     ('b','c'),
. . . . . . . . >     ('1','2'),
. . . . . . . . >     ('2','3'),
. . . . . . . . >     ('3','4'),
. . . . . . . . >     ('4','5'),
. . . . . . . . >     ('5','6'),
. . . . . . . . >     ('6','7'),
. . . . . . . . >     ('7','8'),
. . . . . . . . >     ('8','9'),
. . . . . . . . >     ('9','10'),
. . . . . . . . >     ('10','11'),
. . . . . . . . >     ('11','12'),
. . . . . . . . >     ('12','13'),
. . . . . . . . >     ('13','14'),
. . . . . . . . >     ('14','15')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * 
. . . . . . . . > from table(applib.flatten_recursive_hierarchy(cursor(select * from deep15)));
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| VERTICES  | MULTIPATH  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 3         | true       | a       | b       | c       | c       | c       | c       | c       | c       | c       | c        | c        | c        | c        | c        | c        |
| 2         | true       | a       | c       | c       | c       | c       | c       | c       | c       | c       | c        | c        | c        | c        | c        | c        |
| 15        | false      | 1       | 2       | 3       | 4       | 5       | 6       | 7       | 8       | 9       | 10       | 11       | 12       | 13       | 14       | 15       |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- tree deeper than maxDepth------------------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table deep16(parent varchar(128), child varchar(128));
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into deep16 values
. . . . . . . . >     ('a','b'),
. . . . . . . . >     ('a','c'),
. . . . . . . . >     ('b','c'),
. . . . . . . . >     ('1','2'),
. . . . . . . . >     ('2','3'),
. . . . . . . . >     ('3','4'),
. . . . . . . . >     ('4','5'),
. . . . . . . . >     ('5','6'),
. . . . . . . . >     ('6','7'),
. . . . . . . . >     ('7','8'),
. . . . . . . . >     ('8','9'),
. . . . . . . . >     ('9','10'),
. . . . . . . . >     ('10','11'),
. . . . . . . . >     ('11','12'),
. . . . . . . . >     ('12','13'),
. . . . . . . . >     ('13','14'),
. . . . . . . . >     ('14','15'),
. . . . . . . . >     ('15','16')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * 
. . . . . . . . > from table(applib.flatten_recursive_hierarchy(cursor(select * from deep16)));
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| VERTICES  | MULTIPATH  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 3         | true       | a       | b       | c       | c       | c       | c       | c       | c       | c       | c        | c        | c        | c        | c        | c        |
| 2         | true       | a       | c       | c       | c       | c       | c       | c       | c       | c       | c        | c        | c        | c        | c        | c        |
| 16        | false      | 1       | 2       | 3       | 4       | 5       | 6       | 7       | 8       | 9       | 10       | 11       | 12       | 13       | 14       | 15       |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- clean up ----------------------------------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> drop table tree1;
0: jdbc:luciddb:> drop table mgraph;
0: jdbc:luciddb:> drop table typeint;
0: jdbc:luciddb:> drop table typetimestamp;
0: jdbc:luciddb:> drop table typedouble;
0: jdbc:luciddb:> drop table deep15 cascade;
0: jdbc:luciddb:> drop table deep16 cascade;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> --------------------
0: jdbc:luciddb:> -- negative tests --
0: jdbc:luciddb:> --------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- loop --------------------------------------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table loop(parent varchar(128), child varchar(128));
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into loop values 
. . . . . . . . >     ('1','2'),
. . . . . . . . >     ('2','1')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * 
. . . . . . . . > from table(applib.flatten_recursive_hierarchy(cursor(select * from loop)));
Error: Graph has cycle(s) of '2' vertices; first 20 in loop(s): '2 1 ' (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> truncate table loop;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into loop values
. . . . . . . . >     ('1','2'),
. . . . . . . . >     ('2','3'),
. . . . . . . . >     ('3','1'),
. . . . . . . . >     ('2','1'),
. . . . . . . . >     ('a','b'),
. . . . . . . . >     ('b','a')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * 
. . . . . . . . > from table(applib.flatten_recursive_hierarchy(cursor(select * from loop)));
Error: Graph has cycle(s) of '5' vertices; first 20 in loop(s): '3 a 2 b 1 ' (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> truncate table loop;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into loop values
. . . . . . . . >     ('1','2'),
. . . . . . . . >     ('2','3'),
. . . . . . . . >     ('3','2')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * 
. . . . . . . . > from table(applib.flatten_recursive_hierarchy(cursor(select * from loop)));
Error: Graph has cycle(s) of '2' vertices; first 20 in loop(s): '3 2 ' (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- input table does not have 2 columns -------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table threecol(c1 varchar(10), c2 varchar(10), c3 varchar(10));
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * 
. . . . . . . . > from table(applib.flatten_recursive_hierarchy(cursor(select * from threecol)));
Error: Input table must have two columns, not '3' (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- record has null child ---------------------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table nullchild(c1 integer, c2 integer);
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into nullchild values (1,2), (3,4), (5,null);
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select *
. . . . . . . . > from table(applib.flatten_recursive_hierarchy(cursor(select * from nullchild)));
Error: This parent '5' must have non-null child (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- clean up ----------------------------------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> drop table loop;
0: jdbc:luciddb:> drop table threecol;
0: jdbc:luciddb:> drop table nullchild;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> !quit
