0: jdbc:luciddb:> create schema flatten;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> set schema 'flatten';
0: jdbc:luciddb:> 
0: jdbc:luciddb:> --------------------
0: jdbc:luciddb:> -- positive tests --
0: jdbc:luciddb:> --------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- simple tree (no multiple path) ------------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table tree1(parent varchar(128), child varchar(128));
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into tree1 values
. . . . . . . . >     ('01','02'),
. . . . . . . . >     ('01','03'),
. . . . . . . . >     ('01','04'),
. . . . . . . . >     ('02','05'),
. . . . . . . . >     ('02','06'),
. . . . . . . . >     ('07','08'),
. . . . . . . . >     ('08','09'),
. . . . . . . . >     ('08','10'),
. . . . . . . . >     ('09','11'),
. . . . . . . . >     ('11','12'),
. . . . . . . . >     ('11','13')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from table(applib.flatten(cursor(select * from tree1)));
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| MAXDEPTH  | MULTIPATH  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 1         | false      | 01      | 04      | 04      | 04      | 04      | 04      | 04      | 04      | 04      | 04       | 04       | 04       | 04       | 04       | 04       |
| 1         | false      | 01      | 03      | 03      | 03      | 03      | 03      | 03      | 03      | 03      | 03       | 03       | 03       | 03       | 03       | 03       |
| 2         | false      | 01      | 02      | 06      | 06      | 06      | 06      | 06      | 06      | 06      | 06       | 06       | 06       | 06       | 06       | 06       |
| 2         | false      | 01      | 02      | 05      | 05      | 05      | 05      | 05      | 05      | 05      | 05       | 05       | 05       | 05       | 05       | 05       |
| 2         | false      | 07      | 08      | 10      | 10      | 10      | 10      | 10      | 10      | 10      | 10       | 10       | 10       | 10       | 10       | 10       |
| 4         | false      | 07      | 08      | 09      | 11      | 13      | 13      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 4         | false      | 07      | 08      | 09      | 11      | 12      | 12      | 12      | 12      | 12      | 12       | 12       | 12       | 12       | 12       | 12       |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- graph with multiple paths -----------------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table mgraph(parent varchar(128), child varchar(128));
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into mgraph values
. . . . . . . . >     ('01','02'),
. . . . . . . . >     ('01','03'),
. . . . . . . . >     ('02','04'),
. . . . . . . . >     ('03','04'),
. . . . . . . . >     ('04','05'),
. . . . . . . . >     ('04','06'),
. . . . . . . . >     ('05','07'),
. . . . . . . . >     ('06','07'),
. . . . . . . . >     ('01','07'),
. . . . . . . . >     ('01','08')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from table(applib.flatten(cursor(select * from mgraph)));
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| MAXDEPTH  | MULTIPATH  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 1         | false      | 01      | 08      | 08      | 08      | 08      | 08      | 08      | 08      | 08      | 08       | 08       | 08       | 08       | 08       | 08       |
| 1         | true       | 01      | 07      | 07      | 07      | 07      | 07      | 07      | 07      | 07      | 07       | 07       | 07       | 07       | 07       | 07       |
| 4         | true       | 01      | 03      | 04      | 06      | 07      | 07      | 07      | 07      | 07      | 07       | 07       | 07       | 07       | 07       | 07       |
| 4         | true       | 01      | 02      | 04      | 06      | 07      | 07      | 07      | 07      | 07      | 07       | 07       | 07       | 07       | 07       | 07       |
| 4         | true       | 01      | 03      | 04      | 05      | 07      | 07      | 07      | 07      | 07      | 07       | 07       | 07       | 07       | 07       | 07       |
| 4         | true       | 01      | 02      | 04      | 05      | 07      | 07      | 07      | 07      | 07      | 07       | 07       | 07       | 07       | 07       | 07       |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> truncate table mgraph;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into mgraph values
. . . . . . . . >     ('01','04'),
. . . . . . . . >     ('00','04'),
. . . . . . . . >     ('01','02'),
. . . . . . . . >     ('02','03'),
. . . . . . . . >     ('03','04'),
. . . . . . . . >     ('04','05'),
. . . . . . . . >     ('06','04'),
. . . . . . . . >     ('02','06'),
. . . . . . . . >     ('01','07'),
. . . . . . . . >     ('07','08'),
. . . . . . . . >     ('07','09'),
. . . . . . . . >     ('05','10'),
. . . . . . . . >     ('05','11'),
. . . . . . . . >     ('09','11'),
. . . . . . . . >     ('11','12'),
. . . . . . . . >     ('11','13'),
. . . . . . . . >     ('10','12'),
. . . . . . . . >     ('12','14')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from table(applib.flatten(cursor(select * from mgraph)));
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| MAXDEPTH  | MULTIPATH  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 4         | true       | 01      | 07      | 09      | 11      | 13      | 13      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 6         | true       | 01      | 02      | 06      | 04      | 05      | 11      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 6         | true       | 01      | 02      | 03      | 04      | 05      | 11      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 4         | true       | 00      | 04      | 05      | 11      | 13      | 13      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 4         | true       | 01      | 04      | 05      | 11      | 13      | 13      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 7         | true       | 01      | 02      | 06      | 04      | 05      | 10      | 12      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 7         | true       | 01      | 02      | 03      | 04      | 05      | 10      | 12      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 5         | true       | 00      | 04      | 05      | 10      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 5         | true       | 01      | 04      | 05      | 10      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 5         | true       | 01      | 07      | 09      | 11      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 7         | true       | 01      | 02      | 06      | 04      | 05      | 11      | 12      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 7         | true       | 01      | 02      | 03      | 04      | 05      | 11      | 12      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 5         | true       | 00      | 04      | 05      | 11      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 5         | true       | 01      | 04      | 05      | 11      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 2         | false      | 01      | 07      | 08      | 08      | 08      | 08      | 08      | 08      | 08      | 08       | 08       | 08       | 08       | 08       | 08       |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- input table has null values at col 1 for root nodes----------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table nullval(c1 varchar(10), c2 varchar(10));
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into nullval values
. . . . . . . . >     (null, '00'),
. . . . . . . . >     (null, '01'),
. . . . . . . . >     ('02', '03'),
. . . . . . . . >     (null, '02'),
. . . . . . . . >     ('02', '04'),
. . . . . . . . >     ('03', '04'),
. . . . . . . . >     ('04', '05'),
. . . . . . . . >     ('04', '06'),
. . . . . . . . >     ('02', '07'),
. . . . . . . . >     ('07', '08'),
. . . . . . . . >     ('08', '09'),
. . . . . . . . >     ('09', '10'),
. . . . . . . . >     ('07', '11'),
. . . . . . . . >     ('11', '12')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from table (applib.flatten(cursor(select * from nullval)));
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| MAXDEPTH  | MULTIPATH  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 0         | false      | 00      | 00      | 00      | 00      | 00      | 00      | 00      | 00      | 00      | 00       | 00       | 00       | 00       | 00       | 00       |
| 0         | false      | 01      | 01      | 01      | 01      | 01      | 01      | 01      | 01      | 01      | 01       | 01       | 01       | 01       | 01       | 01       |
| 3         | false      | 02      | 07      | 11      | 12      | 12      | 12      | 12      | 12      | 12      | 12       | 12       | 12       | 12       | 12       | 12       |
| 4         | false      | 02      | 07      | 08      | 09      | 10      | 10      | 10      | 10      | 10      | 10       | 10       | 10       | 10       | 10       | 10       |
| 3         | true       | 02      | 03      | 04      | 06      | 06      | 06      | 06      | 06      | 06      | 06       | 06       | 06       | 06       | 06       | 06       |
| 2         | true       | 02      | 04      | 06      | 06      | 06      | 06      | 06      | 06      | 06      | 06       | 06       | 06       | 06       | 06       | 06       |
| 3         | true       | 02      | 03      | 04      | 05      | 05      | 05      | 05      | 05      | 05      | 05       | 05       | 05       | 05       | 05       | 05       |
| 2         | true       | 02      | 04      | 05      | 05      | 05      | 05      | 05      | 05      | 05      | 05       | 05       | 05       | 05       | 05       | 05       |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> truncate table nullval;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into nullval values 
. . . . . . . . >     ('01','04'),
. . . . . . . . >     (null, '00'),
. . . . . . . . >     ('00','04'),
. . . . . . . . >     ('01','02'),
. . . . . . . . >     ('02','03'),
. . . . . . . . >     (null, '01'),
. . . . . . . . >     ('03','04'),
. . . . . . . . >     ('04','05'),
. . . . . . . . >     ('06','04'),
. . . . . . . . >     ('02','06'),
. . . . . . . . >     ('01','07'),
. . . . . . . . >     ('07','08'),
. . . . . . . . >     ('07','09'),
. . . . . . . . >     ('05','10'),
. . . . . . . . >     ('05','11'),
. . . . . . . . >     ('09','11'),
. . . . . . . . >     ('11','12'),
. . . . . . . . >     ('11','13'),
. . . . . . . . >     ('10','12'),
. . . . . . . . >     ('12','14')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from table (applib.flatten(cursor(select * from nullval)));
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| MAXDEPTH  | MULTIPATH  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 4         | true       | 01      | 07      | 09      | 11      | 13      | 13      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 6         | true       | 01      | 02      | 06      | 04      | 05      | 11      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 6         | true       | 01      | 02      | 03      | 04      | 05      | 11      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 4         | true       | 00      | 04      | 05      | 11      | 13      | 13      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 4         | true       | 01      | 04      | 05      | 11      | 13      | 13      | 13      | 13      | 13      | 13       | 13       | 13       | 13       | 13       | 13       |
| 7         | true       | 01      | 02      | 06      | 04      | 05      | 10      | 12      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 7         | true       | 01      | 02      | 03      | 04      | 05      | 10      | 12      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 5         | true       | 00      | 04      | 05      | 10      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 5         | true       | 01      | 04      | 05      | 10      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 5         | true       | 01      | 07      | 09      | 11      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 7         | true       | 01      | 02      | 06      | 04      | 05      | 11      | 12      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 7         | true       | 01      | 02      | 03      | 04      | 05      | 11      | 12      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 5         | true       | 00      | 04      | 05      | 11      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 5         | true       | 01      | 04      | 05      | 11      | 12      | 14      | 14      | 14      | 14      | 14       | 14       | 14       | 14       | 14       | 14       |
| 2         | false      | 01      | 07      | 08      | 08      | 08      | 08      | 08      | 08      | 08      | 08       | 08       | 08       | 08       | 08       | 08       |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- input table has non-string type -----------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table typeint(parent int, child int);
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into typeint values
. . . . . . . . >     (null,1),
. . . . . . . . >     (null,2),
. . . . . . . . >     (2,3),
. . . . . . . . >     (2,4),
. . . . . . . . >     (2,5),
. . . . . . . . >     (5,6),
. . . . . . . . >     (2,6),
. . . . . . . . >     (6,7)
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from table (applib.flatten(cursor(select * from typeint)));
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| MAXDEPTH  | MULTIPATH  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 0         | false      | 1       | 1       | 1       | 1       | 1       | 1       | 1       | 1       | 1       | 1        | 1        | 1        | 1        | 1        | 1        |
| 2         | true       | 2       | 6       | 7       | 7       | 7       | 7       | 7       | 7       | 7       | 7        | 7        | 7        | 7        | 7        | 7        |
| 3         | true       | 2       | 5       | 6       | 7       | 7       | 7       | 7       | 7       | 7       | 7        | 7        | 7        | 7        | 7        | 7        |
| 1         | false      | 2       | 4       | 4       | 4       | 4       | 4       | 4       | 4       | 4       | 4        | 4        | 4        | 4        | 4        | 4        |
| 1         | false      | 2       | 3       | 3       | 3       | 3       | 3       | 3       | 3       | 3       | 3        | 3        | 3        | 3        | 3        | 3        |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table typedouble(parent double, child double);
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into typedouble values
. . . . . . . . >     (null,1.0),
. . . . . . . . >     (null,2.0),
. . . . . . . . >     (2.0,3.0),
. . . . . . . . >     (2.0,4.0),
. . . . . . . . >     (2.0,5.0),
. . . . . . . . >     (5.0,6.0),
. . . . . . . . >     (2.0,6.0),
. . . . . . . . >     (6.0,7.0)
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from table (applib.flatten(cursor(select * from typedouble)));
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| MAXDEPTH  | MULTIPATH  | LEVEL1  | LEVEL2  | LEVEL3  | LEVEL4  | LEVEL5  | LEVEL6  | LEVEL7  | LEVEL8  | LEVEL9  | LEVEL10  | LEVEL11  | LEVEL12  | LEVEL13  | LEVEL14  | LEVEL15  |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
| 0         | false      | 1.0     | 1.0     | 1.0     | 1.0     | 1.0     | 1.0     | 1.0     | 1.0     | 1.0     | 1.0      | 1.0      | 1.0      | 1.0      | 1.0      | 1.0      |
| 2         | true       | 2.0     | 6.0     | 7.0     | 7.0     | 7.0     | 7.0     | 7.0     | 7.0     | 7.0     | 7.0      | 7.0      | 7.0      | 7.0      | 7.0      | 7.0      |
| 3         | true       | 2.0     | 5.0     | 6.0     | 7.0     | 7.0     | 7.0     | 7.0     | 7.0     | 7.0     | 7.0      | 7.0      | 7.0      | 7.0      | 7.0      | 7.0      |
| 1         | false      | 2.0     | 4.0     | 4.0     | 4.0     | 4.0     | 4.0     | 4.0     | 4.0     | 4.0     | 4.0      | 4.0      | 4.0      | 4.0      | 4.0      | 4.0      |
| 1         | false      | 2.0     | 3.0     | 3.0     | 3.0     | 3.0     | 3.0     | 3.0     | 3.0     | 3.0     | 3.0      | 3.0      | 3.0      | 3.0      | 3.0      | 3.0      |
+-----------+------------+---------+---------+---------+---------+---------+---------+---------+---------+---------+----------+----------+----------+----------+----------+----------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table typetimestamp(parent timestamp, child timestamp);
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into typetimestamp values
. . . . . . . . >     (null,timestamp'2002-01-01 01:56:00'),
. . . . . . . . >     (null,timestamp'2002-01-02 01:56:00'),
. . . . . . . . >     (timestamp'2002-01-02 01:56:00',timestamp'2002-01-03 01:56:00'),
. . . . . . . . >     (timestamp'2002-01-02 01:56:00',timestamp'2002-01-04 01:56:00'),
. . . . . . . . >     (timestamp'2002-01-02 01:56:00',timestamp'2002-01-05 01:56:00'),
. . . . . . . . >     (timestamp'2002-01-05 01:56:00',timestamp'2002-01-06 01:56:00'),
. . . . . . . . >     (timestamp'2002-01-02 01:56:00',timestamp'2002-01-06 01:56:00'),
. . . . . . . . >     (timestamp'2002-01-06 01:56:00',timestamp'2002-01-07 01:56:00')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from table (applib.flatten(cursor(select * from typetimestamp)));
+-----------+------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+
| MAXDEPTH  | MULTIPATH  |         LEVEL1         |         LEVEL2         |         LEVEL3         |         LEVEL4         |         LEVEL5         |         LEVEL6         |         LEVEL7         |         LEVEL8         |         LEVEL9         |        LEVEL10         |        LEVEL11         |        LEVEL12         |        LEVEL13         |        LEVEL14         |        LEVEL15         |
+-----------+------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+
| 0         | false      | 2002-01-01 01:56:00.0  | 2002-01-01 01:56:00.0  | 2002-01-01 01:56:00.0  | 2002-01-01 01:56:00.0  | 2002-01-01 01:56:00.0  | 2002-01-01 01:56:00.0  | 2002-01-01 01:56:00.0  | 2002-01-01 01:56:00.0  | 2002-01-01 01:56:00.0  | 2002-01-01 01:56:00.0  | 2002-01-01 01:56:00.0  | 2002-01-01 01:56:00.0  | 2002-01-01 01:56:00.0  | 2002-01-01 01:56:00.0  | 2002-01-01 01:56:00.0  |
| 2         | true       | 2002-01-02 01:56:00.0  | 2002-01-06 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  |
| 3         | true       | 2002-01-02 01:56:00.0  | 2002-01-05 01:56:00.0  | 2002-01-06 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  | 2002-01-07 01:56:00.0  |
| 1         | false      | 2002-01-02 01:56:00.0  | 2002-01-04 01:56:00.0  | 2002-01-04 01:56:00.0  | 2002-01-04 01:56:00.0  | 2002-01-04 01:56:00.0  | 2002-01-04 01:56:00.0  | 2002-01-04 01:56:00.0  | 2002-01-04 01:56:00.0  | 2002-01-04 01:56:00.0  | 2002-01-04 01:56:00.0  | 2002-01-04 01:56:00.0  | 2002-01-04 01:56:00.0  | 2002-01-04 01:56:00.0  | 2002-01-04 01:56:00.0  | 2002-01-04 01:56:00.0  |
| 1         | false      | 2002-01-02 01:56:00.0  | 2002-01-03 01:56:00.0  | 2002-01-03 01:56:00.0  | 2002-01-03 01:56:00.0  | 2002-01-03 01:56:00.0  | 2002-01-03 01:56:00.0  | 2002-01-03 01:56:00.0  | 2002-01-03 01:56:00.0  | 2002-01-03 01:56:00.0  | 2002-01-03 01:56:00.0  | 2002-01-03 01:56:00.0  | 2002-01-03 01:56:00.0  | 2002-01-03 01:56:00.0  | 2002-01-03 01:56:00.0  | 2002-01-03 01:56:00.0  |
+-----------+------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+------------------------+
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- clean up ----------------------------------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> drop table tree1 cascade;
0: jdbc:luciddb:> drop table mgraph cascade;
0: jdbc:luciddb:> drop table typeint;
0: jdbc:luciddb:> drop table typetimestamp;
0: jdbc:luciddb:> drop table typedouble;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> 
0: jdbc:luciddb:> --------------------
0: jdbc:luciddb:> -- negative tests --
0: jdbc:luciddb:> --------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- loop --------------------------------------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table loop(parent varchar(128), child varchar(128));
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into loop values 
. . . . . . . . >     ('1','2'),
. . . . . . . . >     ('2','1')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from table(applib.flatten(cursor(select * from loop)));
Error: Graph has cycle(s), cannot be flattened. (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> truncate table loop;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into loop values
. . . . . . . . >     ('1','2'),
. . . . . . . . >     ('2','3'),
. . . . . . . . >     ('3','1')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from table(applib.flatten(cursor(select * from loop)));
Error: Graph has cycle(s), cannot be flattened. (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> truncate table loop;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into loop values
. . . . . . . . >     ('1','2'),
. . . . . . . . >     ('2','3'),
. . . . . . . . >     ('3','2')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from table(applib.flatten(cursor(select * from loop)));
Error: Graph has cycle(s), cannot be flattened. (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- tree deeper than maxDepth------------------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table deep(parent varchar(128), child varchar(128));
0: jdbc:luciddb:> 
0: jdbc:luciddb:> insert into deep values
. . . . . . . . >     ('a','b'),
. . . . . . . . >     ('a','c'),
. . . . . . . . >     ('b','c'),
. . . . . . . . >     ('1','2'),
. . . . . . . . >     ('2','3'),
. . . . . . . . >     ('3','4'),
. . . . . . . . >     ('4','5'),
. . . . . . . . >     ('5','6'),
. . . . . . . . >     ('6','7'),
. . . . . . . . >     ('7','8'),
. . . . . . . . >     ('8','9'),
. . . . . . . . >     ('9','10'),
. . . . . . . . >     ('10','11'),
. . . . . . . . >     ('11','12'),
. . . . . . . . >     ('12','13'),
. . . . . . . . >     ('13','14'),
. . . . . . . . >     ('14','15'),
. . . . . . . . >     ('15','16')
. . . . . . . . > ;
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from table(applib.flatten(cursor(select * from deep)));
Error: Path is deeper than specified maxDepth (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create view dpview as
. . . . . . . . >     select * from table(applib.flatten(cursor(select * from deep)));
0: jdbc:luciddb:> select * from dpview;
Error: Path is deeper than specified maxDepth (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- input table does not have 2 columns -------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> create table threecol(c1 varchar(10), c2 varchar(10), c3 varchar(10));
0: jdbc:luciddb:> 
0: jdbc:luciddb:> select * from table (applib.flatten(cursor(select * from threecol)));
Error: Input table must have 2 columns (state=,code=0)
0: jdbc:luciddb:> 
0: jdbc:luciddb:> 
0: jdbc:luciddb:> -- clean up ----------------------------------------------------------
0: jdbc:luciddb:> 
0: jdbc:luciddb:> drop table loop cascade;
0: jdbc:luciddb:> drop table deep cascade;
0: jdbc:luciddb:> drop table threecol cascade;
0: jdbc:luciddb:> !quit
