-- Query 1
SELECT AL1.CU_ID, AL1.CUIN_LST_NM, AL1.CUIN_FST_NM,
 AL3.SRVPLN_ID, AL3.SRVPLN_NM, AL3.SPO_ID, AL3.BU_CD,
 AL3.RC_CD, AVG(AL5.USG_VAL), AVG(AL5.USG_BILL_THERM),
 AVG(AL5.USG_BILL_KWH), AVG(AL5.RSD_SVC_BILG_AMT)
FROM
 PGE.CUST_SERV_ACCT AL1,
 PGE.GEOG AL2,
 PGE.SERV_PLAN AL3,
 PGE.REVN_PRD AL4,
 PGE.REVN_DTL_RAND AL5
WHERE AL5.REVN_YR_MO=AL4.REVN_YR_MO
 AND AL2.GEOG_KEY=AL5.GEOG_KEY
 AND AL3.SRVPLN_KEY=AL5.SRVPLN_KEY
 AND AL1.CUST_SERV_ACCT_KEY=AL5.CUST_SERV_ACCT_KEY
 AND AL1.CUST_SERV_ACCT_KEY IN
  (SELECT DISTINCT AL1.CUST_SERV_ACCT_KEY
   FROM
    PGE.CUST_SERV_ACCT AL1,
    PGE.GEOG AL2, 
    PGE.SERV_PLAN AL3,
    PGE.REVN_PRD AL4,
    PGE.REVN_DTL_RAND AL5
   WHERE AL5.REVN_YR_MO=AL4.REVN_YR_MO
    AND AL2.GEOG_KEY=AL5.GEOG_KEY
    AND AL3.SRVPLN_KEY=AL5.SRVPLN_KEY
    AND AL1.CUST_SERV_ACCT_KEY=AL5.CUST_SERV_ACCT_KEY
    AND AL5.SAS_FNL_BIL_INDCR='Y' AND AL4.REVN_YR=1995)
GROUP BY AL1.CU_ID, AL1.CUIN_LST_NM, AL1.CUIN_FST_NM,
 AL3.SRVPLN_ID, AL3.SRVPLN_NM, AL3.SPO_ID, AL3.BU_CD, AL3.RC_CD
ORDER BY *
;

-- Query 2
SELECT AL3.SRVPLN_KEY, AL3.SRVPLN_ID,
 AL3.SRVPLN_NM, AL3.SPO_ID, AL3.SPO_NM,
 AL3.BU_CD, AL3.RC_CD, AL3.PROC_BAT_ID,
 AL4.REVN_YR_MO, AVG(AL5.USG_DAYS_NUM),
 AVG(AL5.RSD_SVC_BILG_AMT), AVG(AL5.USGC_BILL_KW_VAL),
 AVG(AL5.USG_BILL_KWH), AVG(AL5.RSD_DMND_CHRG_AMT),
 AVG(AL5.RSD_CUST_CHRG_AMT), AVG(AL5.RSD_CCOGC_AMT),
 AVG(AL5.RSD_CCOGA_AMT), AVG(AL5.RSD_TOP_SRCHRG_AMT),
 AVG(AL5.RSD_BALG_CHRG_AMT), AVG(AL5.RSD_ST_SLSTX_AMT),
 AVG(AL5.RSD_TRSPT_CHRG_AMT)
FROM
 PGE.CUST_SERV_ACCT AL1,
 PGE.GEOG AL2,
 PGE.SERV_PLAN AL3,
 PGE.REVN_PRD AL4,
 PGE.REVN_DTL_RAND AL5
WHERE (AL5.REVN_YR_MO=AL4.REVN_YR_MO
 AND AL2.GEOG_KEY=AL5.GEOG_KEY AND AL3.SRVPLN_KEY=AL5.SRVPLN_KEY
 AND AL1.CUST_SERV_ACCT_KEY=AL5.CUST_SERV_ACCT_KEY)  AND
 (AL2.ST_CD='IN' AND AL2.GEOG_CNTY_DESC='LAPORTE'
 AND AL2.RVTWN_DESC='LA PORTE' AND AL4.REVN_YR=1995
 AND AL3.SPO_NM='ELE SPACE HEAT - RES'
 AND AL3.SRVPLN_NM='ELEC - RESIDENTIAL')
GROUP BY AL3.SRVPLN_KEY, AL3.SRVPLN_ID,
 AL3.SRVPLN_NM, AL3.SPO_ID, AL3.SPO_NM,
 AL3.BU_CD, AL3.RC_CD, AL3.PROC_BAT_ID, AL4.REVN_YR_MO
ORDER BY 13 
;
-- Query 3
SELECT AL3.SRVPLN_ID, AL3.SRVPLN_NM,
 AL3.RC_CD, AL3.RC_DESC, AL4.REVN_YR_MO,
 AVG(AL5.USG_VAL), AVG(AL5.USG_BILL_THERM),
 AVG(AL5.RSD_SVC_BILG_AMT)
FROM
 PGE.CUST_SERV_ACCT AL1,
 PGE.GEOG AL2,
 PGE.SERV_PLAN AL3,
 PGE.REVN_PRD AL4,
 PGE.REVN_DTL_RAND AL5
WHERE (AL5.REVN_YR_MO=AL4.REVN_YR_MO
 AND AL2.GEOG_KEY=AL5.GEOG_KEY AND AL3.SRVPLN_KEY=AL5.SRVPLN_KEY
 AND AL1.CUST_SERV_ACCT_KEY=AL5.CUST_SERV_ACCT_KEY)
 AND (AL3.SRVPLN_NM='GAS - MULT FAMILY HOUSING'
 AND AL3.SPO_ID=1
 AND AL3.RC_DESC='MULTIPLE DWELLING - G''NRL SERV'
 AND AL4.REVN_YR=1995)
GROUP BY AL3.SRVPLN_ID,
 AL3.SRVPLN_NM, AL3.RC_CD, AL3.RC_DESC, AL4.REVN_YR_MO
ORDER BY 5,6,7,8
;
-- Query 4
SELECT AL4.REVN_YR_MO, AL2.GEOG_CNTY_CD, AL2.GEOG_CNTY_DESC,
 AL2.RVTWN_CD, AL2.RVTWN_DESC, COUNT(AL1.CU_ID)
FROM
 PGE.CUST_SERV_ACCT AL1,
 PGE.GEOG AL2,
 PGE.SERV_PLAN AL3,
 PGE.REVN_PRD AL4,
 PGE.REVN_DTL_RAND AL5
WHERE (AL5.REVN_YR_MO=AL4.REVN_YR_MO AND AL2.GEOG_KEY=AL5.GEOG_KEY
 AND AL3.SRVPLN_KEY=AL5.SRVPLN_KEY AND
 AL1.CUST_SERV_ACCT_KEY=AL5.CUST_SERV_ACCT_KEY)
 AND (AL5.SAS_FNL_BIL_INDCR='Y')
GROUP BY AL4.REVN_YR_MO, AL2.GEOG_CNTY_CD, AL2.GEOG_CNTY_DESC,
 AL2.RVTWN_CD, AL2.RVTWN_DESC
ORDER BY 5, 1, 6
;
-- Query 5
SELECT AL5.CUST_SERV_ACCT_KEY, AL5.REVN_YR_MO,
 AL5.USG_VAL, AL5.USG_BILL_THERM, AL5.USG_BILL_KWH
FROM PGE.CUST_SERV_ACCT AL1,
 PGE.GEOG AL2,
 PGE.SERV_PLAN AL3,
 PGE.REVN_PRD AL4,
 PGE.REVN_DTL_RAND AL5
WHERE (AL5.REVN_YR_MO=AL4.REVN_YR_MO
 AND AL2.GEOG_KEY=AL5.GEOG_KEY
 AND AL3.SRVPLN_KEY=AL5.SRVPLN_KEY
 AND AL1.CUST_SERV_ACCT_KEY=AL5.CUST_SERV_ACCT_KEY)
 AND (AL1.CUST_SERV_ACCT_KEY IN (112621, 112631, 112633,
 112634, 112635, 112653, 112654, 112662, 112687, 112775,
 112878, 112954, 113010, 113014))
ORDER BY 1
;
-- Query 6
SELECT AL1.CUST_SERV_ACCT_KEY, AL1.CUOR_CUST_NM,
 AL1.CUIN_LST_NM, AL1.CUIN_FST_NM, AL1.SERV_ADDR,
 AL1.ST_CD, AL1.ZIP_CD_NUM, AL1.CO_CD, AL5.USG_VAL,
 AL5.USG_BILL_THERM, AL5.RSD_SVC_BILG_AMT,
 AL5.RSD_ST_SLSTX_AMT
FROM
 PGE.CUST_SERV_ACCT AL1,
 PGE.GEOG AL2,
 PGE.SERV_PLAN AL3,
 PGE.REVN_PRD AL4,
 PGE.REVN_DTL_RAND AL5
WHERE (AL5.REVN_YR_MO=AL4.REVN_YR_MO
 AND AL2.GEOG_KEY=AL5.GEOG_KEY AND AL3.SRVPLN_KEY=AL5.SRVPLN_KEY
 AND AL1.CUST_SERV_ACCT_KEY=AL5.CUST_SERV_ACCT_KEY)
 AND (AL1.CUST_SERV_ACCT_KEY IN (112456, 112875, 112894,
 112955, 112965, 113111, 113196, 113222, 113241, 113246,
 113287, 113492, 113521, 113565, 113625, 113649, 113654,
 113687, 113698, 113724, 113785, 113846, 113987, 113999,
 114111, 114121, 114123, 114167, 114235, 114333, 114335,
 114444, 114555, 114673, 114876, 114921, 114948))
ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12
;
-- Query 7
SELECT AL1.USG_VAL, AL1.USG_BILL_THERM, AL1.USG_BILL_KWH,
 AL1.USGC_BILL_KW_VAL, AL1.RSD_SVC_BILG_AMT, AL1.RSD_ST_SLSTX_AMT,
 AL1.RSD_CUST_CHRG_AMT, AL1.PROC_BAT_ID
FROM PGE.REVN_DTL_RAND AL1
WHERE (AL1.CUST_SERV_ACCT_KEY IN (112678, 112690, 112698, 112735,
 112745, 112746, 112753, 112778, 112793, 112826, 112845, 112870,
 112873, 112875, 112879, 112896, 112953, 112980, 112987, 113000,
 113001, 113028, 113036, 113045, 113049, 113050, 113055, 113064,
 113067, 113069, 113075, 113089, 113095, 113111, 113147, 113159,
 113164, 113169, 113184, 113186, 113189, 113214, 113215, 113245,
 113247, 113254, 113256, 113258, 113265, 113267, 113268, 113285,
 113321, 113336, 113338, 113349, 113357, 113369, 113409, 113486,
 113507, 113540, 113542, 113654, 113672, 113680, 113684, 113687,
 113695, 113698, 113726, 113742, 113753, 113756, 113764, 113789,
 113796, 113802, 113806, 113821, 113840, 113854, 113856, 113860,
 113862, 113874, 113891, 113896, 113907, 113950, 113951, 113961,
 113962, 113987, 114020, 114023, 114036, 114039, 114057, 114060,
 114062, 114079, 114087, 114096, 114098, 114109, 114123, 114130,
 114148, 114149, 114159, 114203, 114206, 114207, 114234, 114237,
 114258, 114267, 114268, 114308, 114345, 114369, 114456, 114578,
 114687, 114789) AND AL1.SRVPLN_KEY IN (171, 174, 190, 215, 219))
ORDER BY 1, 2, 3, 4, 5, 6, 7, 8
;

-- Query 8
SELECT AL4.REVN_YR, AL4.REVN_MO, AL3.SRVPLN_ID,
 AL3.SRVPLN_NM, AL2.GEOG_CNTY_CD, SUM(AL5.RSD_SVC_BILG_AMT)
FROM
 PGE.CUST_SERV_ACCT AL1,
 PGE.GEOG AL2,
 PGE.SERV_PLAN AL3,
 PGE.REVN_PRD AL4,
 PGE.REVN_DTL_RAND AL5
 WHERE (AL5.REVN_YR_MO=AL4.REVN_YR_MO
 AND AL2.GEOG_KEY=AL5.GEOG_KEY
 AND AL3.SRVPLN_KEY=AL5.SRVPLN_KEY
 AND AL1.CUST_SERV_ACCT_KEY=AL5.CUST_SERV_ACCT_KEY)
GROUP BY AL4.REVN_YR, AL4.REVN_MO, AL3.SRVPLN_ID,
 AL3.SRVPLN_NM, AL2.GEOG_CNTY_CD
ORDER BY  5, 1, 2, 3, 4, 6
;

-- Query 9
SELECT AL2.ST_CD, AL2.GEOG_CNTY_DESC, AL2.RVTWN_DESC,
 AL3.SRVPLN_ID, AL3.SRVPLN_NM, AL3.SPO_ID, AL3.SPO_NM,
 COUNT(AL1.CU_ID)
FROM
 PGE.CUST_SERV_ACCT AL1,
 PGE.GEOG AL2,
 PGE.SERV_PLAN AL3,
 PGE.REVN_PRD AL4,
 PGE.REVN_DTL_RAND AL5
 WHERE (AL5.REVN_YR_MO=AL4.REVN_YR_MO
 AND AL2.GEOG_KEY=AL5.GEOG_KEY
 AND AL3.SRVPLN_KEY=AL5.SRVPLN_KEY
 AND AL1.CUST_SERV_ACCT_KEY=AL5.CUST_SERV_ACCT_KEY)
GROUP by  AL2.ST_CD, AL2.GEOG_CNTY_DESC, AL2.RVTWN_DESC,
 AL3.SRVPLN_ID, AL3.SRVPLN_NM, AL3.SPO_ID, AL3.SPO_NM
ORDER BY  2,3,4,5,7,8
;

-- Query 10
SELECT AL1.CU_ID, AL1.CUOR_CUST_NM, AL1.CUIN_LST_NM, AL1.ST_CD,
 AL1.ZIP_CD_NUM, AL1.CO_CD, AL1.IS_DWLGS_VAL, AL3.SRVPLN_ID,
 AL3.SRVPLN_NM, AVG(AL5.USG_VAL), AVG(AL5.USG_BILL_THERM),
 AVG(AL5.RSD_SVC_BILG_AMT)
FROM
 PGE.CUST_SERV_ACCT AL1,
 PGE.GEOG AL2,
 PGE.SERV_PLAN AL3,
 PGE.REVN_PRD AL4,
 PGE.REVN_DTL_RAND AL5
WHERE (AL5.REVN_YR_MO=AL4.REVN_YR_MO
 AND AL2.GEOG_KEY=AL5.GEOG_KEY AND AL3.SRVPLN_KEY=AL5.SRVPLN_KEY
 AND AL1.CUST_SERV_ACCT_KEY=AL5.CUST_SERV_ACCT_KEY)
 AND (AL4.REVN_YR_MO=
  (SELECT max(AL4.REVN_YR_MO) FROM PGE.REVN_PRD AL4)
 AND AL1.IS_DWLGS_VAL>1 AND AL3.SRVPLN_NM LIKE '%MULT%')
GROUP BY AL1.CU_ID, AL1.CUOR_CUST_NM, AL1.CUIN_LST_NM, AL1.ST_CD,
 AL1.ZIP_CD_NUM, AL1.CO_CD, AL1.IS_DWLGS_VAL, AL3.SRVPLN_ID,
 AL3.SRVPLN_NM
ORDER BY  7 DESC, 1, 2, 3, 4, 5, 6, 8, 9, 10, 11, 12
;

-- Query 11
SELECT AL4.REVN_YR_MO, AL3.SRVPLN_ID, AL3.SRVPLN_NM,
 SUM(AL5.RSD_SVC_BILG_AMT)
FROM
 PGE.CUST_SERV_ACCT AL1,
 PGE.GEOG AL2,
 PGE.SERV_PLAN AL3,
 PGE.REVN_PRD AL4,
 PGE.REVN_DTL_RAND AL5
WHERE (AL5.REVN_YR_MO=AL4.REVN_YR_MO
 AND AL2.GEOG_KEY=AL5.GEOG_KEY AND AL3.SRVPLN_KEY=AL5.SRVPLN_KEY
 AND AL1.CUST_SERV_ACCT_KEY=AL5.CUST_SERV_ACCT_KEY)
GROUP BY AL4.REVN_YR_MO, AL3.SRVPLN_ID, AL3.SRVPLN_NM
ORDER BY 1,2,3
;
-- Query 12
SELECT AL4.REVN_YR_MO, AL1.CU_ID, AL3.SRVPLN_ID,
 AL3.SRVPLN_NM, AL3.SPO_ID, AL3.SPO_NM, AL3.BU_CD,
 AL3.RC_CD, AL1.CUOR_CUST_NM, AL1.CUIN_LST_NM,
 AL1.CUIN_FST_NM, AL1.MAIL_ADDR_ID
FROM
 PGE.CUST_SERV_ACCT AL1,
 PGE.GEOG AL2,
 PGE.SERV_PLAN AL3,
 PGE.REVN_PRD AL4,
 PGE.REVN_DTL_RAND AL5
WHERE (AL5.REVN_YR_MO=AL4.REVN_YR_MO
 AND AL2.GEOG_KEY=AL5.GEOG_KEY AND AL3.SRVPLN_KEY=AL5.SRVPLN_KEY
 AND AL1.CUST_SERV_ACCT_KEY=AL5.CUST_SERV_ACCT_KEY)
 AND (AL5.SAS_FNL_BIL_INDCR='Y')
 AND (AL4.REVN_YR_MO=
  (select max(AL4.REVN_YR_MO) FROM PGE.REVN_PRD AL4))
GROUP BY AL4.REVN_YR_MO, AL1.CU_ID, AL3.SRVPLN_ID,
 AL3.SRVPLN_NM, AL3.SPO_ID, AL3.SPO_NM, AL3.BU_CD,
 AL3.RC_CD, AL1.CUOR_CUST_NM, AL1.CUIN_LST_NM, AL1.CUIN_FST_NM,
 AL1.MAIL_ADDR_ID
ORDER BY 2, 3
;

-- Query 13
SELECT AL2.ST_CD, AL2.GEOG_CNTY_CD, AL2.GEOG_CNTY_DESC,
 SUM(AL5.RSD_SVC_BILG_AMT), SUM(AL5.RSD_ST_SLSTX_AMT),
 SUM(AL5.RSD_TRSPT_CHRG_AMT), SUM(AL5.RSD_BALG_CHRG_AMT),
 SUM(AL5.RSD_TOP_SRCHRG_AMT), SUM(AL5.RSD_CCOGA_AMT),
 SUM(AL5.RSD_CCOGC_AMT), SUM(AL5.RSD_CUST_CHRG_AMT),
 SUM(AL5.RSD_DMND_CHRG_AMT)
FROM
 PGE.CUST_SERV_ACCT AL1,
 PGE.GEOG AL2,
 PGE.SERV_PLAN AL3,
 PGE.REVN_PRD AL4,
 PGE.REVN_DTL_RAND AL5
WHERE (AL5.REVN_YR_MO=AL4.REVN_YR_MO
 AND AL2.GEOG_KEY=AL5.GEOG_KEY AND AL3.SRVPLN_KEY=AL5.SRVPLN_KEY
 AND AL1.CUST_SERV_ACCT_KEY=AL5.CUST_SERV_ACCT_KEY)
 AND (AL3.SRVPLN_ID=311 AND AL4.REVN_YR=1995)
GROUP BY AL2.ST_CD, AL2.GEOG_CNTY_CD,
 AL2.GEOG_CNTY_DESC
ORDER BY  2
;

-- Query 14
SELECT AL2.ST_CD, AL2.GEOG_CNTY_CD, AL2.GEOG_CNTY_DESC,
 SUM(AL5.RSD_SVC_BILG_AMT), SUM(AL5.RSD_ST_SLSTX_AMT),
 SUM(AL5.RSD_TRSPT_CHRG_AMT), SUM(AL5.RSD_BALG_CHRG_AMT),
 SUM(AL5.RSD_TOP_SRCHRG_AMT), SUM(AL5.RSD_CCOGA_AMT),
 SUM(AL5.RSD_CCOGC_AMT), SUM(AL5.RSD_CUST_CHRG_AMT),
 SUM(AL5.RSD_DMND_CHRG_AMT)
FROM
 PGE.CUST_SERV_ACCT AL1,
 PGE.GEOG AL2,
 PGE.SERV_PLAN AL3,
 PGE.REVN_PRD AL4,
 PGE.REVN_DTL_RAND AL5
WHERE (AL5.REVN_YR_MO=AL4.REVN_YR_MO
 AND AL2.GEOG_KEY=AL5.GEOG_KEY AND AL3.SRVPLN_KEY=AL5.SRVPLN_KEY
 AND AL1.CUST_SERV_ACCT_KEY=AL5.CUST_SERV_ACCT_KEY)
 AND (AL3.SRVPLN_ID=811 AND AL4.REVN_YR=1995)
GROUP BY AL2.ST_CD, AL2.GEOG_CNTY_CD,
 AL2.GEOG_CNTY_DESC
ORDER BY  2
;

-- Query 15
SELECT AL1.USG_VAL, AL1.USG_BILL_THERM, AL1.USG_BILL_KWH,
 AL1.USGC_BILL_KW_VAL, AL1.RSD_SVC_BILG_AMT,
 AL1.RSD_ST_SLSTX_AMT, AL1.RSD_CUST_CHRG_AMT,
 AL1.PROC_BAT_ID
FROM PGE.REVN_DTL_RAND AL1
 WHERE (AL1.CUST_SERV_ACCT_KEY IN (112678, 112698,
 112778, 112875, 112879, 112953, 112987, 113111, 113147,
 113159, 113214, 113245, 113247, 113254, 113256, 113258,
 113357, 113369, 113542, 113654, 113698, 113789, 113856,
 113874, 113896, 113987, 114123, 114148, 114149, 114159,
 114234, 114237, 114258, 114267, 114268, 114345, 114369,
 114456, 114578, 114687, 114789))
ORDER BY 1, 2, 3, 4, 5, 6, 7, 8
;

-- Query 16
SELECT AL1.SRVPLN_ID, AL1.SRVPLN_NM,
 SUM(AL2.RSD_SVC_BILG_AMT)
FROM
 PGE.SERV_PLAN AL1,
 PGE.REVN_DTL_RAND AL2
WHERE (AL1.SRVPLN_KEY=AL2.SRVPLN_KEY)
GROUP BY AL1.SRVPLN_ID, AL1.SRVPLN_NM
ORDER BY  3 DESC
;

-- Query 17
SELECT AL1.CU_ID, AL4.REVN_YR_MO, SUM(AL5.USG_VAL),
 SUM(AL5.USG_BILL_THERM), SUM(AL5.USGC_BILL_KW_VAL),
 SUM(AL5.RSD_SVC_BILG_AMT), AL5.RSD_CU_CNT
FROM
 PGE.CUST_SERV_ACCT AL1,
 PGE.GEOG AL2,
 PGE.SERV_PLAN AL3,
 PGE.REVN_PRD AL4,
 PGE.REVN_DTL_RAND AL5
WHERE (AL5.REVN_YR_MO=AL4.REVN_YR_MO
 AND AL2.GEOG_KEY=AL5.GEOG_KEY AND AL3.SRVPLN_KEY=AL5.SRVPLN_KEY
 AND AL1.CUST_SERV_ACCT_KEY=AL5.CUST_SERV_ACCT_KEY)
 AND (AL2.ST_CD='IN' AND AL2.GEOG_CNTY_DESC='LAPORTE'
 AND AL4.REVN_YR=1995 AND AL3.SRVPLN_NM LIKE '%DUSK%'
 AND AL3.SPO_NM LIKE '%SODIUM%'
 AND AL3.RC_DESC='RESIDENTIAL - GENERAL SERVICE')
GROUP BY AL1.CU_ID, AL4.REVN_YR_MO, AL5.RSD_CU_CNT
ORDER BY 1, 2, 3,4,5,6
;

-- Query 18
SELECT AL2.RVTWN_DESC, AL4.REVN_QTR, AL3.SRVPLN_ID,
 AL3.SRVPLN_NM, SUM(AL5.USG_VAL), SUM(AL5.USG_BILL_THERM),
 SUM(AL5.RSD_SVC_BILG_AMT)
FROM
 PGE.CUST_SERV_ACCT AL1,
 PGE.GEOG AL2,
 PGE.SERV_PLAN AL3,
 PGE.REVN_PRD AL4,
 PGE.REVN_DTL_RAND AL5
WHERE (AL5.REVN_YR_MO=AL4.REVN_YR_MO
 AND AL2.GEOG_KEY=AL5.GEOG_KEY AND AL3.SRVPLN_KEY=AL5.SRVPLN_KEY
 AND AL1.CUST_SERV_ACCT_KEY=AL5.CUST_SERV_ACCT_KEY)
 AND (AL4.REVN_YR=1995 AND AL3.SRVPLN_NM LIKE '%RESIDENTIAL%'
 AND AL2.ST_CD='IN' AND AL2.GEOG_CNTY_DESC='LAPORTE'
 AND AL5.RSD_CU_CNT=1)
GROUP BY AL2.RVTWN_DESC, AL4.REVN_QTR,
 AL3.SRVPLN_ID, AL3.SRVPLN_NM
ORDER BY  2, 1, 3, 4, 5, 6, 7
;

-- Query 19 - Two Outers

-- In Oracle outer-join syntax:
-- SELECT DISTINCT AL1.IS_DWLGS_VAL, AL1.CU_ID,
--  AL1.CUOR_CUST_NM, AL1.CUIN_LST_NM, AL2.SRVPLN_ID
-- FROM PGE.CUST_SERV_ACCT AL1, PGE.SERV_PLAN AL2, PGE.REVN_DTL_RAND AL3
-- WHERE (AL3.SRVPLN_KEY=AL2.SRVPLN_KEY(+)
--  AND AL1.CUST_SERV_ACCT_KEY=AL3.CUST_SERV_ACCT_KEY(+))
--  AND (AL1.IS_DWLGS_VAL>2)
-- ORDER BY  5

SELECT DISTINCT AL1.IS_DWLGS_VAL, AL1.CU_ID,
 AL1.CUOR_CUST_NM, AL1.CUIN_LST_NM, AL2.SRVPLN_ID
FROM ((PGE.CUST_SERV_ACCT AL1
       LEFT OUTER JOIN PGE.REVN_DTL_RAND AL3
       ON AL1.CUST_SERV_ACCT_KEY=AL3.CUST_SERV_ACCT_KEY)
      LEFT OUTER JOIN PGE.SERV_PLAN AL2 on AL3.SRVPLN_KEY = AL2.SRVPLN_KEY)
WHERE AL1.IS_DWLGS_VAL > 2
ORDER BY 1,2,3,4,5
;

-- Query 20 - One Outer
-- In Oracle outer-join syntax:
-- SELECT DISTINCT AL1.IS_DWLGS_VAL, AL1.CU_ID, AL1.CUOR_CUST_NM,
--  AL1.CUIN_LST_NM, AL2.SRVPLN_ID
-- FROM PGE.CUST_SERV_ACCT AL1, PGE.SERV_PLAN AL2, PGE.REVN_DTL_RAND AL3
-- WHERE (AL1.CUST_SERV_ACCT_KEY=AL3.CUST_SERV_ACCT_KEY(+)
--  AND AL3.SRVPLN_KEY=AL2.SRVPLN_KEY)
--  AND (AL1.IS_DWLGS_VAL>2)
-- ORDER BY  5

SELECT DISTINCT AL1.IS_DWLGS_VAL, AL1.CU_ID, AL1.CUOR_CUST_NM,
AL1.CUIN_LST_NM, AL2.SRVPLN_ID
 FROM (PGE.CUST_SERV_ACCT AL1 LEFT OUTER JOIN PGE.REVN_DTL_RAND AL3
       ON AL1.CUST_SERV_ACCT_KEY = AL3.CUST_SERV_ACCT_KEY),
  PGE.SERV_PLAN AL2
 WHERE
        AL3.SRVPLN_KEY = AL2.SRVPLN_KEY AND
        AL1.IS_DWLGS_VAL > 2
 ORDER BY 5
;

-- Query 20b
SELECT DISTINCT AL1.IS_DWLGS_VAL, AL1.CU_ID, AL1.CUOR_CUST_NM,
AL1.CUIN_LST_NM, AL2.SRVPLN_ID
 FROM (PGE.CUST_SERV_ACCT AL1 LEFT OUTER JOIN pge.revn_dtl_rand AL3
        ON AL1.CUST_SERV_ACCT_KEY = AL3.CUST_SERV_ACCT_KEY),
  PGE.SERV_PLAN AL2
 WHERE
        AL3.SRVPLN_KEY = AL2.SRVPLN_KEY 
  AND   AL1.IS_DWLGS_VAL = 1
  AND   AL3.rsd_svc_bilg_amt > 1000
 ORDER BY 1,2,3,4,5
;

-- Query 21 -- Joy new 
SELECT c.cust_serv_acct_key,
       c.cuin_lst_nm,
       t.revn_yr_mo,
       sum(f.RSD_SVC_BILG_AMT)
FROM   (SELECT cust_serv_acct_key,
       max(rsd_svc_bilg_amt) maxamt 
        FROM pge.revn_dtl_rand 
        GROUP by cust_serv_acct_key 
        HAVING max(rsd_svc_bilg_amt) > 500) keys,
        pge.cust_serv_acct c,
        pge.revn_dtl_rand f,
        pge.revn_prd t
WHERE   t.revn_yr_mo = f.revn_yr_mo
and     c.cust_serv_acct_key = f.cust_serv_acct_key
and     t.revn_yr = 1995
and     c.cust_serv_acct_key = keys.cust_serv_acct_key
GROUP BY c.cust_serv_acct_key, c.cuin_lst_nm, t.revn_yr_mo
ORDER BY 1, 2, 3, 4
;

-- Query 22 -- Joy new, BB only
select cust_serv_acct_key, sum(rsd_svc_bilg_amt) topcust_amt
from pge.revn_dtl_rand
group by cust_serv_acct_key having rank( sum(rsd_svc_bilg_amt) ) <= 10
;

