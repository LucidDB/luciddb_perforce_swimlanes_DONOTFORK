0: jdbc:farrago:> -- $Id: //open/dt/dev/farrago/unitsql/optimizer/calc.sql#2 $
0: jdbc:farrago:> -- Test queries which instantiate the calculator (filter and/or project)
0: jdbc:farrago:> 
0: jdbc:farrago:> set schema 'sales';
0: jdbc:farrago:> 
0: jdbc:farrago:> -- force usage of Fennel calculator
0: jdbc:farrago:> alter system set "calcVirtualMachine" = 'CALCVM_FENNEL';
0: jdbc:farrago:> 
0: jdbc:farrago:> -- filter which returns one row
0: jdbc:farrago:> explain plan for
. . . . . . . . > select name from emps where lower(name) = 'wilma';
+-------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                                     column0                                                                     |
+-------------------------------------------------------------------------------------------------------------------------------------------------+
| FennelToIteratorConverter                                                                                                                       |
|   FennelPullCalcRel(NAME=[$1], condition=[=(LOWER($1), _ISO-8859-1'wilma')])                                                                    |
|     FtrsIndexScanRel(table=[[LOCALDB, SALES, EMPS]], projection=[*], index=[SYS$CONSTRAINT_INDEX$EMPS$SYS$PRIMARY_KEY], preserveOrder=[false])  |
+-------------------------------------------------------------------------------------------------------------------------------------------------+
0: jdbc:farrago:> 
0: jdbc:farrago:> -- project
0: jdbc:farrago:> explain plan for
. . . . . . . . > select lower(name), empid + 1, empid / 1, empid - 1, empid from sales.emps;
+-------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                                     column0                                                                     |
+-------------------------------------------------------------------------------------------------------------------------------------------------+
| FennelToIteratorConverter                                                                                                                       |
|   FennelPullCalcRel(EXPR$0=[LOWER($1)], EXPR$1=[+($5, 1)], EXPR$2=[/($5, 1)], EXPR$3=[-($5, 1)], EMPID=[$5])                                    |
|     FtrsIndexScanRel(table=[[LOCALDB, SALES, EMPS]], projection=[*], index=[SYS$CONSTRAINT_INDEX$EMPS$SYS$PRIMARY_KEY], preserveOrder=[false])  |
+-------------------------------------------------------------------------------------------------------------------------------------------------+
0: jdbc:farrago:> 
0: jdbc:farrago:> -- dtbug#32
0: jdbc:farrago:> explain plan for
. . . . . . . . > select 1 + 2 from values (3);
+----------------------------------------+
|                column0                 |
+----------------------------------------+
| FennelToIteratorConverter              |
|   FennelPullCalcRel(EXPR$0=[+(1, 2)])  |
|     IteratorToFennelConverter          |
|       IterOneRowRel                    |
+----------------------------------------+
0: jdbc:farrago:> 
0: jdbc:farrago:> select 1 + 2 from values (3);
+---------+
| EXPR$0  |
+---------+
| 3       |
+---------+
0: jdbc:farrago:> 
0: jdbc:farrago:> !quit
