> -- Test management views
> 
> select count(url) from sys_boot.mgmt.sessions_view;
+---------+
| EXPR$0  |
+---------+
| 2       |
+---------+
> 
> select sql_stmt from sys_boot.mgmt.statements_view;
+-----------------------------------------------------+
|                      SQL_STMT                       |
+-----------------------------------------------------+
| select sql_stmt from sys_boot.mgmt.statements_view  |
+-----------------------------------------------------+
> 
> select count(mof_id) from sys_boot.mgmt.objects_in_use_view;
+---------+
| EXPR$0  |
+---------+
| 2       |
+---------+
> 
> select sys_boot.mgmt.sleep(1500) from (values(0));
+---------+
| EXPR$0  |
+---------+
| 0       |
+---------+
> 
> select count("mofId") from sys_boot.mgmt.dba_foreign_wrappers_internal;
+---------+
| EXPR$0  |
+---------+
| 4       |
+---------+
> 
> select count(*) from sys_boot.mgmt.dba_views_internal2
> where catalog_name='SYS_BOOT' and schema_name='MGMT';
+---------+
| EXPR$0  |
+---------+
| 33      |
+---------+
> 
> select parameter_name from sys_boot.mgmt.dba_routine_parameters_internal1
> where schema_name='MGMT' and routine_specific_name='SLEEP'
> order by 1;
+-----------------+
| PARAMETER_NAME  |
+-----------------+
| MILLIS          |
| RETURN          |
+-----------------+
> 
> -- SYS_CWM/FEM use different wrappers depending on repository configuration
> select foreign_wrapper_name, foreign_server_name
> from sys_boot.mgmt.dba_foreign_servers_internal2
> where foreign_server_name not in ('SYS_CWM', 'SYS_FEM')
> order by 1,2;
+-----------------------+-------------------------------+
| FOREIGN_WRAPPER_NAME  |      FOREIGN_SERVER_NAME      |
+-----------------------+-------------------------------+
| SYS_JDBC              | HSQLDB_DEMO                   |
| SYS_MDR               | SYS_MOF                       |
| SYS_MOCK_FOREIGN      | SYS_MOCK_FOREIGN_DATA_SERVER  |
+-----------------------+-------------------------------+
> 
> select foreign_server_name
> from sys_boot.mgmt.dba_foreign_servers_internal2
> order by 1;
+-------------------------------+
|      FOREIGN_SERVER_NAME      |
+-------------------------------+
| HSQLDB_DEMO                   |
| SYS_CWM                       |
| SYS_FEM                       |
| SYS_MOCK_FOREIGN_DATA_SERVER  |
| SYS_MOF                       |
+-------------------------------+
> 
> create schema mtest;
> create table mtest.t(col int primary key);
> insert into mtest.t values (1), (2), (3);
> 
> select count(*) from sys_boot.mgmt.dba_schemas_internal2
> where schema_name='MTEST';
+---------+
| EXPR$0  |
+---------+
| 1       |
+---------+
> 
> select table_name, table_type from sys_boot.mgmt.dba_tables_internal2
> where schema_name='MTEST';
+-------------+--------------+
| TABLE_NAME  |  TABLE_TYPE  |
+-------------+--------------+
| T           | LOCAL TABLE  |
+-------------+--------------+
> 
> analyze table mtest.t estimate statistics for all columns sample 66 percent;
> 
> select table_name, last_analyze_row_count 
> from sys_boot.mgmt.dba_stored_tables_internal2
> where schema_name='MTEST';
+-------------+-------------------------+
| TABLE_NAME  | LAST_ANALYZE_ROW_COUNT  |
+-------------+-------------------------+
| T           | 3                       |
+-------------+-------------------------+
> 
> drop schema mtest cascade;
> 
> select * from table(sys_boot.mgmt.browse_foreign_schemas('HSQLDB_DEMO'))
> order by schema_name;
+---------------------+--------------+
|     SCHEMA_NAME     | DESCRIPTION  |
+---------------------+--------------+
| INFORMATION_SCHEMA  |              |
| PUBLIC              |              |
| SALES               |              |
+---------------------+--------------+
> 
> select * from table(sys_boot.mgmt.browse_foreign_schema_tables('HSQLDB_DEMO', 'SALES'));
+-------------+--------------+
| TABLE_NAME  | DESCRIPTION  |
+-------------+--------------+
| BITFLIP     |              |
| DEPT        |              |
| EMP         |              |
| SALGRADE    |              |
+-------------+--------------+
> 
> select * from table(sys_boot.mgmt.browse_foreign_schema_columns('HSQLDB_DEMO', 'SALES'));
+-------------+--------------+----------+-----------+------------+-------------+--------------+---------------------+--------------+----------------+
| TABLE_NAME  | COLUMN_NAME  | ORDINAL  | DATATYPE  | PRECISION  | DEC_DIGITS  | IS_NULLABLE  | FORMATTED_DATATYPE  | DESCRIPTION  | DEFAULT_VALUE  |
+-------------+--------------+----------+-----------+------------+-------------+--------------+---------------------+--------------+----------------+
| BITFLIP     | B1           | 0        | BOOLEAN   | 1          | 0           | true         | BOOLEAN             |              |                |
| BITFLIP     | B2           | 1        | BOOLEAN   | 1          | 0           | false        | BOOLEAN             |              |                |
| DEPT        | DEPTNO       | 0        | INTEGER   | 10         | 0           | true         | INTEGER             |              |                |
| DEPT        | DNAME        | 1        | VARCHAR   | 1024       | 0           | true         | VARCHAR(1024)       |              |                |
| DEPT        | LOC          | 2        | VARCHAR   | 1024       | 0           | true         | VARCHAR(1024)       |              |                |
| EMP         | EMPNO        | 0        | INTEGER   | 10         | 0           | true         | INTEGER             |              |                |
| EMP         | ENAME        | 1        | VARCHAR   | 1024       | 0           | true         | VARCHAR(1024)       |              |                |
| EMP         | JOB          | 2        | VARCHAR   | 1024       | 0           | true         | VARCHAR(1024)       |              |                |
| EMP         | MGR          | 3        | INTEGER   | 10         | 0           | true         | INTEGER             |              |                |
| EMP         | HIREDATE     | 4        | DATE      | 0          | 0           | true         | DATE                |              |                |
| EMP         | SAL          | 5        | DECIMAL   | 19         | 0           | true         | DECIMAL(19, 0)      |              |                |
| EMP         | COMM         | 6        | DECIMAL   | 19         | 0           | true         | DECIMAL(19, 0)      |              |                |
| EMP         | DEPTNO       | 7        | INTEGER   | 10         | 0           | true         | INTEGER             |              |                |
| SALGRADE    | GRADE        | 0        | INTEGER   | 10         | 0           | true         | INTEGER             |              |                |
| SALGRADE    | LOSAL        | 1        | INTEGER   | 10         | 0           | true         | INTEGER             |              |                |
| SALGRADE    | HISAL        | 2        | INTEGER   | 10         | 0           | true         | INTEGER             |              |                |
+-------------+--------------+----------+-----------+------------+-------------+--------------+---------------------+--------------+----------------+
> 
> -- specialize the JDBC foreign wrapper for a particular DBMS;
> -- note that the url setting is intended to be interpreted as a template
> create foreign data wrapper hsqldb_wrapper
> library '${FARRAGO_HOME}/plugin/FarragoMedJdbc.jar'
> language java
> options(
>     browse_connect_description 'Hypersonic',
>     driver_class 'org.hsqldb.jdbcDriver',
>     url 'jdbc:hsqldb:path/to/data'
> );
> 
> -- note that none of the system wrappers should have 
> -- browse_connect_description set, so don't need ORDER BY here
> select * from sys_boot.mgmt.browse_connect_foreign_wrappers;
+-----------------------+-----------------------------+
| FOREIGN_WRAPPER_NAME  | BROWSE_CONNECT_DESCRIPTION  |
+-----------------------+-----------------------------+
| HSQLDB_WRAPPER        | Hypersonic                  |
+-----------------------+-----------------------------+
> 
> -- query for available options with no proposed settings (empty_view)
> select * from table(
>   sys_boot.mgmt.browse_connect_foreign_server(
>     'HSQLDB_WRAPPER',
>     cursor(table sys_boot.mgmt.browse_connect_empty_options)))
> order by option_ordinal, option_choice_ordinal;
+-----------------+-------------------+-----------------------------------------------------+---------------------+------------------------+---------------------------+
| OPTION_ORDINAL  |    OPTION_NAME    |                 OPTION_DESCRIPTION                  | IS_OPTION_REQUIRED  | OPTION_CHOICE_ORDINAL  |    OPTION_CHOICE_VALUE    |
+-----------------+-------------------+-----------------------------------------------------+---------------------+------------------------+---------------------------+
| 0               | DRIVER_CLASS      | Fully-qualified class name of JDBC driver to load   | true                | -1                     | org.hsqldb.jdbcDriver     |
| 1               | URL               | JDBC URL for data source                            | true                | -1                     | jdbc:hsqldb:path/to/data  |
| 2               | USER_NAME         | User name for authentication in source DBMS         | false               | -1                     |                           |
| 3               | PASSWORD          | Password for authentication in source DBMS          | false               | -1                     |                           |
| 4               | EXTENDED_OPTIONS  | Whether driver-specific options should be accepted  | true                | -1                     | FALSE                     |
| 4               | EXTENDED_OPTIONS  | Whether driver-specific options should be accepted  | true                | 0                      | FALSE                     |
| 4               | EXTENDED_OPTIONS  | Whether driver-specific options should be accepted  | true                | 1                      | TRUE                      |
+-----------------+-------------------+-----------------------------------------------------+---------------------+------------------------+---------------------------+
> 
> -- query again with a real URL, asking for extended options:  
> -- should get back details direct from driver
> select option_name, option_choice_ordinal, option_choice_value from table(
>   sys_boot.mgmt.browse_connect_foreign_server(
>     'HSQLDB_WRAPPER',
>     cursor(
>         values ('URL', 'jdbc:hsqldb:testcases/hsqldb/scott'),
>                ('EXTENDED_OPTIONS', 'TRUE'))))
> order by option_ordinal, option_choice_ordinal;
+-------------------+------------------------+-------------------------------------+
|    OPTION_NAME    | OPTION_CHOICE_ORDINAL  |         OPTION_CHOICE_VALUE         |
+-------------------+------------------------+-------------------------------------+
| DRIVER_CLASS      | -1                     | org.hsqldb.jdbcDriver               |
| URL               | -1                     | jdbc:hsqldb:testcases/hsqldb/scott  |
| USER_NAME         | -1                     |                                     |
| PASSWORD          | -1                     |                                     |
| EXTENDED_OPTIONS  | -1                     | TRUE                                |
| EXTENDED_OPTIONS  | 0                      | FALSE                               |
| EXTENDED_OPTIONS  | 1                      | TRUE                                |
| user              | -1                     |                                     |
| password          | -1                     |                                     |
| get_column_name   | -1                     | true                                |
| get_column_name   | 0                      | true                                |
| get_column_name   | 1                      | false                               |
| ifexists          | -1                     |                                     |
| ifexists          | 0                      | true                                |
| ifexists          | 1                      | false                               |
| default_schema    | -1                     |                                     |
| default_schema    | 0                      | true                                |
| default_schema    | 1                      | false                               |
| shutdown          | -1                     |                                     |
| shutdown          | 0                      | true                                |
| shutdown          | 1                      | false                               |
+-------------------+------------------------+-------------------------------------+
> 
> -- NOTE jvs 17-Sept-2006:  Next ones return too much noise to make
> -- it possible to check their results; just verify that they can execute
> 
> select * from table(sys_boot.mgmt.threads()) where false;
+------------+--------------------+--------------+------------------+---------------+-----------+------------+-----------------+
| THREAD_ID  | THREAD_GROUP_NAME  | THREAD_NAME  | THREAD_PRIORITY  | THREAD_STATE  | IS_ALIVE  | IS_DAEMON  | IS_INTERRUPTED  |
+------------+--------------------+--------------+------------------+---------------+-----------+------------+-----------------+
+------------+--------------------+--------------+------------------+---------------+-----------+------------+-----------------+
> 
> select * from table(sys_boot.mgmt.thread_stack_entries()) where false;
+------------+--------------+---------------+-------------+--------------+------------+-----------+------------+
| THREAD_ID  | STACK_LEVEL  | ENTRY_STRING  | CLASS_NAME  | METHOD_NAME  | FILE_NAME  | LINE_NUM  | IS_NATIVE  |
+------------+--------------+---------------+-------------+--------------+------------+-----------+------------+
+------------+--------------+---------------+-------------+--------------+------------+-----------+------------+
> 
> select * from table(sys_boot.mgmt.system_info()) where false;
+-----------+--------------+--------------+------------+-------------+-------------+
| CATEGORY  | SUBCATEGORY  | SOURCE_NAME  | ITEM_NAME  | ITEM_UNITS  | ITEM_VALUE  |
+-----------+--------------+--------------+------------+-------------+-------------+
+-----------+--------------+--------------+------------+-------------+-------------+
> 
> select * from table(sys_boot.mgmt.performance_counters()) where false;
+-------------------+----------------------+--------------+---------------+----------------+----------------+
| COUNTER_CATEGORY  | COUNTER_SUBCATEGORY  | SOURCE_NAME  | COUNTER_NAME  | COUNTER_UNITS  | COUNTER_VALUE  |
+-------------------+----------------------+--------------+---------------+----------------+----------------+
+-------------------+----------------------+--------------+---------------+----------------+----------------+
> 
> select source_name, counter_name 
> from table(sys_boot.mgmt.performance_counters())
> order by source_name, counter_name;
+--------------+------------------------------------------+
| SOURCE_NAME  |               COUNTER_NAME               |
+--------------+------------------------------------------+
| Fennel       | CacheCheckpointWrites                    |
| Fennel       | CacheCheckpointWritesSinceInit           |
| Fennel       | CacheDirtyPages                          |
| Fennel       | CacheHits                                |
| Fennel       | CacheHitsSinceInit                       |
| Fennel       | CacheLazyWriteCalls                      |
| Fennel       | CacheLazyWriteCallsSinceInit             |
| Fennel       | CacheLazyWrites                          |
| Fennel       | CacheLazyWritesSinceInit                 |
| Fennel       | CachePageIoRetries                       |
| Fennel       | CachePageIoRetriesSinceInit              |
| Fennel       | CachePagePrefetchesRejected              |
| Fennel       | CachePagePrefetchesRejectedSinceInit     |
| Fennel       | CachePagesAllocated                      |
| Fennel       | CachePagesAllocationLimit                |
| Fennel       | CachePagesGoverned                       |
| Fennel       | CachePagesPrefetched                     |
| Fennel       | CachePagesPrefetchedSinceInit            |
| Fennel       | CachePagesRead                           |
| Fennel       | CachePagesReadSinceInit                  |
| Fennel       | CachePagesReserved                       |
| Fennel       | CachePagesUnused                         |
| Fennel       | CachePagesWritten                        |
| Fennel       | CachePagesWrittenSinceInit               |
| Fennel       | CacheRequests                            |
| Fennel       | CacheRequestsSinceInit                   |
| Fennel       | CacheReservePercentage                   |
| Fennel       | CacheVictimizationWrites                 |
| Fennel       | CacheVictimizationWritesSinceInit        |
| Fennel       | CacheVictimizations                      |
| Fennel       | CacheVictimizationsSinceInit             |
| Fennel       | DatabaseCheckpoints                      |
| Fennel       | DatabaseCheckpointsSinceInit             |
| Fennel       | DatabasePagesAllocated                   |
| Fennel       | DatabasePagesExtendedSinceInit           |
| Fennel       | DatabasePagesOccupiedHighWaterSinceInit  |
| Fennel       | ExpectedConcurrentStatements             |
| Fennel       | TempPagesAllocated                       |
| Fennel       | TempPagesExtendedSinceInit               |
| Fennel       | TempPagesOccupiedHighWaterSinceInit      |
| JVM          | JvmMemoryAllocated                       |
| JVM          | JvmMemoryAllocationLimit                 |
| JVM          | JvmMemoryUnused                          |
| JVM          | JvmNanoTime                              |
+--------------+------------------------------------------+
> 
> call sys_boot.mgmt.create_directory('testgen/mgmt_files');
> 
> create server test_server
> foreign data wrapper sys_file_wrapper
> options (
>     directory 'testgen/mgmt_files/',
>     file_extension 'csv',
>     with_header 'yes', 
>     lenient 'no');
> create server test_server2
> foreign data wrapper sys_file_wrapper
> options (
>     directory 'testgen/mgmt_files/',
>     file_extension 'csv',
>     with_header 'yes', 
>     lenient 'no');
> 
> call sys_boot.mgmt.flush_code_cache();
> 
> -- should pass
> call sys_boot.mgmt.test_data_server('TEST_SERVER');
> 
> call sys_boot.mgmt.flush_code_cache();
> 
> -- should pass
> call sys_boot.mgmt.test_all_servers_for_wrapper('SYS_FILE_WRAPPER');
> 
> call sys_boot.mgmt.delete_file_or_directory('testgen/mgmt_files');
> 
> call sys_boot.mgmt.flush_code_cache();
> 
> -- should fail now that directory is gone
> call sys_boot.mgmt.test_data_server('TEST_SERVER');
Error: Directory testgen/mgmt_files/ does not exist (state=,code=0)
> 
> call sys_boot.mgmt.flush_code_cache();
> 
> -- should fail now that directory is gone
> call sys_boot.mgmt.test_all_servers_for_wrapper('SYS_FILE_WRAPPER');
Error: Directory testgen/mgmt_files/ does not exist (state=,code=0)
> 
> -- set code cache size to some arbitrary number
> alter system set "codeCacheMaxBytes" = 42000;
> 
> call sys_boot.mgmt.flush_code_cache();
> 
> -- verify that flush did not modify code cache size
> select "codeCacheMaxBytes" from sys_fem."Config"."FarragoConfig";
+--------------------+
| codeCacheMaxBytes  |
+--------------------+
| 42000              |
+--------------------+
> 
> -- test generate ddl functions, should all pass
> 
> -- test local catalog
> select statement from table(sys_boot.mgmt.generate_ddl_for_catalog());
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                                                                           STATEMENT                                                                                                           |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| CREATE OR REPLACE FOREIGN DATA WRAPPER "HSQLDB_WRAPPER" LIBRARY '${FARRAGO_HOME}/plugin/FarragoMedJdbc.jar'                                                                                                                   |
| LANGUAGE JAVA                                                                                                                                                                                                                 |
| OPTIONS (                                                                                                                                                                                                                     |
|   "BROWSE_CONNECT_DESCRIPTION" 'Hypersonic',                                                                                                                                                                                  |
|   "DRIVER_CLASS" 'org.hsqldb.jdbcDriver',                                                                                                                                                                                     |
|   "URL" 'jdbc:hsqldb:path/to/data'                                                                                                                                                                                            |
| );                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE FOREIGN DATA WRAPPER "SYS_COLUMN_STORE" LIBRARY 'class org.luciddb.lcs.LcsDataWrapper'                                                                                                                      |
| LANGUAGE JAVA;                                                                                                                                                                                                                |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE FOREIGN DATA WRAPPER "SYS_FILE_WRAPPER" LIBRARY 'class net.sf.farrago.namespace.flatfile.FlatFileDataWrapper'                                                                                               |
| LANGUAGE JAVA;                                                                                                                                                                                                                |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE FOREIGN DATA WRAPPER "SYS_FTRS" LIBRARY 'class net.sf.farrago.namespace.ftrs.FtrsDataWrapper'                                                                                                               |
| LANGUAGE JAVA;                                                                                                                                                                                                                |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE FOREIGN DATA WRAPPER "SYS_JDBC" LIBRARY '${FARRAGO_HOME}/plugin/FarragoMedJdbc.jar'                                                                                                                         |
| LANGUAGE JAVA;                                                                                                                                                                                                                |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE FOREIGN DATA WRAPPER "SYS_MDR" LIBRARY 'class net.sf.farrago.namespace.mdr.MedMdrForeignDataWrapper'                                                                                                        |
| LANGUAGE JAVA;                                                                                                                                                                                                                |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE FOREIGN DATA WRAPPER "SYS_MOCK" LIBRARY 'class net.sf.farrago.namespace.mock.MedMockLocalDataWrapper'                                                                                                       |
| LANGUAGE JAVA;                                                                                                                                                                                                                |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE FOREIGN DATA WRAPPER "SYS_MOCK_FOREIGN" LIBRARY 'class net.sf.farrago.namespace.mock.MedMockForeignDataWrapper'                                                                                             |
| LANGUAGE JAVA;                                                                                                                                                                                                                |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SCHEMA "INFORMATION_SCHEMA";                                                                                                                                                                                |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SCHEMA "SALES";                                                                                                                                                                                             |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SCHEMA "SQLJ";                                                                                                                                                                                              |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE ROLE "PUBLIC";                                                                                                                                                                                              |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE USER "_SYSTEM"                                                                                                                                                                                              |
| AUTHORIZATION 'Unused';                                                                                                                                                                                                       |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE USER "sa"                                                                                                                                                                                                   |
| AUTHORIZATION 'Unused';                                                                                                                                                                                                       |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "SYS_COLUMN_STORE_DATA_SERVER"                                                                                                                                                                       |
| FOREIGN DATA WRAPPER "SYS_COLUMN_STORE";                                                                                                                                                                                      |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "TEST_SERVER"                                                                                                                                                                                        |
| FOREIGN DATA WRAPPER "SYS_FILE_WRAPPER"                                                                                                                                                                                       |
| OPTIONS (                                                                                                                                                                                                                     |
|   "DIRECTORY" 'testgen/mgmt_files/',                                                                                                                                                                                          |
|   "FILE_EXTENSION" 'csv',                                                                                                                                                                                                     |
|   "LENIENT" 'no',                                                                                                                                                                                                             |
|   "WITH_HEADER" 'yes'                                                                                                                                                                                                         |
| );                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "TEST_SERVER2"                                                                                                                                                                                       |
| FOREIGN DATA WRAPPER "SYS_FILE_WRAPPER"                                                                                                                                                                                       |
| OPTIONS (                                                                                                                                                                                                                     |
|   "DIRECTORY" 'testgen/mgmt_files/',                                                                                                                                                                                          |
|   "FILE_EXTENSION" 'csv',                                                                                                                                                                                                     |
|   "LENIENT" 'no',                                                                                                                                                                                                             |
|   "WITH_HEADER" 'yes'                                                                                                                                                                                                         |
| );                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "SYS_FTRS_DATA_SERVER"                                                                                                                                                                               |
| FOREIGN DATA WRAPPER "SYS_FTRS";                                                                                                                                                                                              |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "HSQLDB_DEMO"                                                                                                                                                                                        |
| FOREIGN DATA WRAPPER "SYS_JDBC"                                                                                                                                                                                               |
| OPTIONS (                                                                                                                                                                                                                     |
|   "DRIVER_CLASS" 'org.hsqldb.jdbcDriver',                                                                                                                                                                                     |
|   "TABLE_TYPES" 'TABLE,VIEW',                                                                                                                                                                                                 |
|   "URL" 'jdbc:hsqldb:testcases/hsqldb/scott',                                                                                                                                                                                 |
|   "USER_NAME" 'SA'                                                                                                                                                                                                            |
| );                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "SYS_CWM"                                                                                                                                                                                            |
| FOREIGN DATA WRAPPER "SYS_JDBC"                                                                                                                                                                                               |
| OPTIONS (                                                                                                                                                                                                                     |
|   "JNDI_NAME" 'java:ENKI_DATASOURCE',                                                                                                                                                                                         |
|   "SCHEMA_NAME" 'DUMMY',                                                                                                                                                                                                      |
|   "TABLE_PREFIX_MAPPING" '%.FEM_VT_Behavioral_%:Behavioral.%;%.FEM_VT_Core_%:Core.%;%.FEM_VT_DataTypes_%:DataTypes.%;%.FEM_VT_Instance_%:Instance.%;%.FEM_VT_KeysIndexes_%:KeysIndexes.%;%.FEM_VT_Relational_%:Relational.%'  |
| );                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "SYS_FEM"                                                                                                                                                                                            |
| FOREIGN DATA WRAPPER "SYS_JDBC"                                                                                                                                                                                               |
| OPTIONS (                                                                                                                                                                                                                     |
|   "JNDI_NAME" 'java:ENKI_DATASOURCE',                                                                                                                                                                                         |
|   "SCHEMA_NAME" 'DUMMY',                                                                                                                                                                                                      |
|   "TABLE_PREFIX_MAPPING" '%.FEM_VT_Config_%:Config.%;%.FEM_VT_Med_%:MED.%;%.FEM_VT_Security_%:Security.%;%.FEM_VT_Sql2003_%:SQL2003.%'                                                                                        |
| );                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "SYS_MOF"                                                                                                                                                                                            |
| FOREIGN DATA WRAPPER "SYS_MDR"                                                                                                                                                                                                |
| OPTIONS (                                                                                                                                                                                                                     |
|   "ROOT_PACKAGE_NAME" 'MOF',                                                                                                                                                                                                  |
|   "SCHEMA_NAME" 'MODEL'                                                                                                                                                                                                       |
| );                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                                                                           STATEMENT                                                                                                           |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| CREATE OR REPLACE SERVER "SYS_MOCK_DATA_SERVER"                                                                                                                                                                               |
| FOREIGN DATA WRAPPER "SYS_MOCK";                                                                                                                                                                                              |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "SYS_MOCK_FOREIGN_DATA_SERVER"                                                                                                                                                                       |
| FOREIGN DATA WRAPPER "SYS_MOCK_FOREIGN";                                                                                                                                                                                      |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE PROCEDURE "SQLJ"."ALTER_JAVA_PATH"(                                                                                                                                                                         |
|   IN "JAR" VARCHAR(2000),                                                                                                                                                                                                     |
|   IN "PATH" VARCHAR(2000))                                                                                                                                                                                                    |
| SPECIFIC "SQLJ"."ALTER_JAVA_PATH"                                                                                                                                                                                             |
| LANGUAGE JAVA                                                                                                                                                                                                                 |
| MODIFIES SQL DATA                                                                                                                                                                                                             |
| NOT DETERMINISTIC                                                                                                                                                                                                             |
| EXTERNAL NAME 'class net.sf.farrago.ddl.DdlSqlj.alter_java_path';                                                                                                                                                             |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE FUNCTION "SALES"."DECRYPT_PUBLIC_KEY"(                                                                                                                                                                      |
|   "K" VARBINARY(50))                                                                                                                                                                                                          |
| RETURNS VARCHAR(25)                                                                                                                                                                                                           |
| SPECIFIC "SALES"."DECRYPT_PUBLIC_KEY"                                                                                                                                                                                         |
| LANGUAGE JAVA                                                                                                                                                                                                                 |
| NO SQL                                                                                                                                                                                                                        |
| NOT DETERMINISTIC                                                                                                                                                                                                             |
| EXTERNAL NAME 'class net.sf.farrago.test.FarragoTestUDR.decryptPublicKey';                                                                                                                                                    |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE PROCEDURE "SQLJ"."INSTALL_JAR"(                                                                                                                                                                             |
|   IN "URL" VARCHAR(2000),                                                                                                                                                                                                     |
|   IN "JAR" VARCHAR(2000),                                                                                                                                                                                                     |
|   IN "DEPLOY" INTEGER)                                                                                                                                                                                                        |
| SPECIFIC "SQLJ"."INSTALL_JAR"                                                                                                                                                                                                 |
| LANGUAGE JAVA                                                                                                                                                                                                                 |
| MODIFIES SQL DATA                                                                                                                                                                                                             |
| NOT DETERMINISTIC                                                                                                                                                                                                             |
| EXTERNAL NAME 'class net.sf.farrago.ddl.DdlSqlj.install_jar';                                                                                                                                                                 |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE FUNCTION "SALES"."MAYBE_FEMALE"(                                                                                                                                                                            |
|   "GENDER" CHAR(1))                                                                                                                                                                                                           |
| RETURNS BOOLEAN                                                                                                                                                                                                               |
| SPECIFIC "SALES"."MAYBE_FEMALE"                                                                                                                                                                                               |
| LANGUAGE SQL                                                                                                                                                                                                                  |
| CONTAINS SQL                                                                                                                                                                                                                  |
| NOT DETERMINISTIC                                                                                                                                                                                                             |
| RETURN NOT (("GENDER" = 'F') IS FALSE);                                                                                                                                                                                       |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE PROCEDURE "SQLJ"."REMOVE_JAR"(                                                                                                                                                                              |
|   IN "JAR" VARCHAR(2000),                                                                                                                                                                                                     |
|   IN "UNDEPLOY" INTEGER)                                                                                                                                                                                                      |
| SPECIFIC "SQLJ"."REMOVE_JAR"                                                                                                                                                                                                  |
| LANGUAGE JAVA                                                                                                                                                                                                                 |
| MODIFIES SQL DATA                                                                                                                                                                                                             |
| NOT DETERMINISTIC                                                                                                                                                                                                             |
| EXTERNAL NAME 'class net.sf.farrago.ddl.DdlSqlj.remove_jar';                                                                                                                                                                  |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE PROCEDURE "SQLJ"."REPLACE_JAR"(                                                                                                                                                                             |
|   IN "URL" VARCHAR(2000),                                                                                                                                                                                                     |
|   IN "JAR" VARCHAR(2000))                                                                                                                                                                                                     |
| SPECIFIC "SQLJ"."REPLACE_JAR"                                                                                                                                                                                                 |
| LANGUAGE JAVA                                                                                                                                                                                                                 |
| MODIFIES SQL DATA                                                                                                                                                                                                             |
| NOT DETERMINISTIC                                                                                                                                                                                                             |
| EXTERNAL NAME 'class net.sf.farrago.ddl.DdlSqlj.replace_jar';                                                                                                                                                                 |
|                                                                                                                                                                                                                               |
| CREATE TABLE "SALES"."DEPTS" (                                                                                                                                                                                                |
|    "DEPTNO" INTEGER NOT NULL,                                                                                                                                                                                                 |
|    "NAME" VARCHAR(128) NOT NULL,                                                                                                                                                                                              |
|    PRIMARY KEY ("DEPTNO"),                                                                                                                                                                                                    |
|    CONSTRAINT "DEPTS_UNIQUE_NAME" UNIQUE("NAME")                                                                                                                                                                              |
| );                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
| CREATE TABLE "SALES"."EMPS" (                                                                                                                                                                                                 |
|    "EMPNO" INTEGER NOT NULL,                                                                                                                                                                                                  |
|    "NAME" VARCHAR(128) NOT NULL,                                                                                                                                                                                              |
|    "DEPTNO" INTEGER NOT NULL,                                                                                                                                                                                                 |
|    "GENDER" CHAR(1) DEFAULT 'M',                                                                                                                                                                                              |
|    "CITY" VARCHAR(128),                                                                                                                                                                                                       |
|    "EMPID" INTEGER NOT NULL,                                                                                                                                                                                                  |
|    "AGE" INTEGER,                                                                                                                                                                                                             |
|    "PUBLIC_KEY" VARBINARY(50),                                                                                                                                                                                                |
|    "SLACKER" BOOLEAN,                                                                                                                                                                                                         |
|    "MANAGER" BOOLEAN NOT NULL,                                                                                                                                                                                                |
|    PRIMARY KEY ("EMPNO","DEPTNO"),                                                                                                                                                                                            |
|    CONSTRAINT "SYS$UNIQUE_KEY$EMPS$EMPID" UNIQUE("EMPID")                                                                                                                                                                     |
| );                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
| CREATE TABLE "SALES"."TEMPS" (                                                                                                                                                                                                |
|    "EMPNO" INTEGER NOT NULL,                                                                                                                                                                                                  |
|    "NAME" VARCHAR(128) NOT NULL,                                                                                                                                                                                              |
|    "DEPTNO" INTEGER NOT NULL,                                                                                                                                                                                                 |
|    "GENDER" CHAR(1),                                                                                                                                                                                                          |
|    "CITY" VARCHAR(128),                                                                                                                                                                                                       |
|    "EMPID" INTEGER DEFAULT 999 NOT NULL,                                                                                                                                                                                      |
|    "AGE" INTEGER,                                                                                                                                                                                                             |
|    "PUBLIC_KEY" VARBINARY(50),                                                                                                                                                                                                |
|    "SLACKER" BOOLEAN,                                                                                                                                                                                                         |
|    "MANAGER" BOOLEAN NOT NULL,                                                                                                                                                                                                |
|    PRIMARY KEY ("EMPNO","DEPTNO")                                                                                                                                                                                             |
| );                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
| CREATE INDEX "EMPS_UX" ON "SALES"."EMPS" ("NAME");                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE VIEW "SALES"."EMPSVIEW" AS                                                                                                                                                                                  |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                                                                           STATEMENT                                                                                                           |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| SELECT "EMPS"."EMPNO", "EMPS"."NAME"                                                                                                                                                                                          |
| FROM "LOCALDB"."SALES"."EMPS" AS "EMPS";                                                                                                                                                                                      |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE VIEW "SALES"."JOINVIEW" AS                                                                                                                                                                                  |
| SELECT "DEPTS"."NAME" AS "DNAME", "EMPS"."NAME" AS "ENAME"                                                                                                                                                                    |
| FROM "LOCALDB"."SALES"."EMPS" AS "EMPS"                                                                                                                                                                                       |
| INNER JOIN "LOCALDB"."SALES"."DEPTS" AS "DEPTS" ON "EMPS"."DEPTNO" = "DEPTS"."DEPTNO";                                                                                                                                        |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE VIEW "SALES"."TEMPSVIEW" AS                                                                                                                                                                                 |
| SELECT "TEMPS"."EMPNO", "TEMPS"."NAME"                                                                                                                                                                                        |
| FROM "LOCALDB"."SALES"."TEMPS" AS "TEMPS";                                                                                                                                                                                    |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
> -- test sys_fem catalog
> select statement from table(sys_boot.mgmt.generate_ddl_for_catalog('SYS_FEM'));
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                                                                           STATEMENT                                                                                                           |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| CREATE OR REPLACE FOREIGN DATA WRAPPER "HSQLDB_WRAPPER" LIBRARY '${FARRAGO_HOME}/plugin/FarragoMedJdbc.jar'                                                                                                                   |
| LANGUAGE JAVA                                                                                                                                                                                                                 |
| OPTIONS (                                                                                                                                                                                                                     |
|   "BROWSE_CONNECT_DESCRIPTION" 'Hypersonic',                                                                                                                                                                                  |
|   "DRIVER_CLASS" 'org.hsqldb.jdbcDriver',                                                                                                                                                                                     |
|   "URL" 'jdbc:hsqldb:path/to/data'                                                                                                                                                                                            |
| );                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE FOREIGN DATA WRAPPER "SYS_COLUMN_STORE" LIBRARY 'class org.luciddb.lcs.LcsDataWrapper'                                                                                                                      |
| LANGUAGE JAVA;                                                                                                                                                                                                                |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE FOREIGN DATA WRAPPER "SYS_FILE_WRAPPER" LIBRARY 'class net.sf.farrago.namespace.flatfile.FlatFileDataWrapper'                                                                                               |
| LANGUAGE JAVA;                                                                                                                                                                                                                |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE FOREIGN DATA WRAPPER "SYS_FTRS" LIBRARY 'class net.sf.farrago.namespace.ftrs.FtrsDataWrapper'                                                                                                               |
| LANGUAGE JAVA;                                                                                                                                                                                                                |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE FOREIGN DATA WRAPPER "SYS_JDBC" LIBRARY '${FARRAGO_HOME}/plugin/FarragoMedJdbc.jar'                                                                                                                         |
| LANGUAGE JAVA;                                                                                                                                                                                                                |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE FOREIGN DATA WRAPPER "SYS_MDR" LIBRARY 'class net.sf.farrago.namespace.mdr.MedMdrForeignDataWrapper'                                                                                                        |
| LANGUAGE JAVA;                                                                                                                                                                                                                |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE FOREIGN DATA WRAPPER "SYS_MOCK" LIBRARY 'class net.sf.farrago.namespace.mock.MedMockLocalDataWrapper'                                                                                                       |
| LANGUAGE JAVA;                                                                                                                                                                                                                |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE FOREIGN DATA WRAPPER "SYS_MOCK_FOREIGN" LIBRARY 'class net.sf.farrago.namespace.mock.MedMockForeignDataWrapper'                                                                                             |
| LANGUAGE JAVA;                                                                                                                                                                                                                |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE ROLE "PUBLIC";                                                                                                                                                                                              |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE USER "_SYSTEM"                                                                                                                                                                                              |
| AUTHORIZATION 'Unused';                                                                                                                                                                                                       |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE USER "sa"                                                                                                                                                                                                   |
| AUTHORIZATION 'Unused';                                                                                                                                                                                                       |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "SYS_COLUMN_STORE_DATA_SERVER"                                                                                                                                                                       |
| FOREIGN DATA WRAPPER "SYS_COLUMN_STORE";                                                                                                                                                                                      |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "TEST_SERVER"                                                                                                                                                                                        |
| FOREIGN DATA WRAPPER "SYS_FILE_WRAPPER"                                                                                                                                                                                       |
| OPTIONS (                                                                                                                                                                                                                     |
|   "DIRECTORY" 'testgen/mgmt_files/',                                                                                                                                                                                          |
|   "FILE_EXTENSION" 'csv',                                                                                                                                                                                                     |
|   "LENIENT" 'no',                                                                                                                                                                                                             |
|   "WITH_HEADER" 'yes'                                                                                                                                                                                                         |
| );                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "TEST_SERVER2"                                                                                                                                                                                       |
| FOREIGN DATA WRAPPER "SYS_FILE_WRAPPER"                                                                                                                                                                                       |
| OPTIONS (                                                                                                                                                                                                                     |
|   "DIRECTORY" 'testgen/mgmt_files/',                                                                                                                                                                                          |
|   "FILE_EXTENSION" 'csv',                                                                                                                                                                                                     |
|   "LENIENT" 'no',                                                                                                                                                                                                             |
|   "WITH_HEADER" 'yes'                                                                                                                                                                                                         |
| );                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "SYS_FTRS_DATA_SERVER"                                                                                                                                                                               |
| FOREIGN DATA WRAPPER "SYS_FTRS";                                                                                                                                                                                              |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "HSQLDB_DEMO"                                                                                                                                                                                        |
| FOREIGN DATA WRAPPER "SYS_JDBC"                                                                                                                                                                                               |
| OPTIONS (                                                                                                                                                                                                                     |
|   "DRIVER_CLASS" 'org.hsqldb.jdbcDriver',                                                                                                                                                                                     |
|   "TABLE_TYPES" 'TABLE,VIEW',                                                                                                                                                                                                 |
|   "URL" 'jdbc:hsqldb:testcases/hsqldb/scott',                                                                                                                                                                                 |
|   "USER_NAME" 'SA'                                                                                                                                                                                                            |
| );                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "SYS_CWM"                                                                                                                                                                                            |
| FOREIGN DATA WRAPPER "SYS_JDBC"                                                                                                                                                                                               |
| OPTIONS (                                                                                                                                                                                                                     |
|   "JNDI_NAME" 'java:ENKI_DATASOURCE',                                                                                                                                                                                         |
|   "SCHEMA_NAME" 'DUMMY',                                                                                                                                                                                                      |
|   "TABLE_PREFIX_MAPPING" '%.FEM_VT_Behavioral_%:Behavioral.%;%.FEM_VT_Core_%:Core.%;%.FEM_VT_DataTypes_%:DataTypes.%;%.FEM_VT_Instance_%:Instance.%;%.FEM_VT_KeysIndexes_%:KeysIndexes.%;%.FEM_VT_Relational_%:Relational.%'  |
| );                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "SYS_FEM"                                                                                                                                                                                            |
| FOREIGN DATA WRAPPER "SYS_JDBC"                                                                                                                                                                                               |
| OPTIONS (                                                                                                                                                                                                                     |
|   "JNDI_NAME" 'java:ENKI_DATASOURCE',                                                                                                                                                                                         |
|   "SCHEMA_NAME" 'DUMMY',                                                                                                                                                                                                      |
|   "TABLE_PREFIX_MAPPING" '%.FEM_VT_Config_%:Config.%;%.FEM_VT_Med_%:MED.%;%.FEM_VT_Security_%:Security.%;%.FEM_VT_Sql2003_%:SQL2003.%'                                                                                        |
| );                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "SYS_MOF"                                                                                                                                                                                            |
| FOREIGN DATA WRAPPER "SYS_MDR"                                                                                                                                                                                                |
| OPTIONS (                                                                                                                                                                                                                     |
|   "ROOT_PACKAGE_NAME" 'MOF',                                                                                                                                                                                                  |
|   "SCHEMA_NAME" 'MODEL'                                                                                                                                                                                                       |
| );                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "SYS_MOCK_DATA_SERVER"                                                                                                                                                                               |
| FOREIGN DATA WRAPPER "SYS_MOCK";                                                                                                                                                                                              |
|                                                                                                                                                                                                                               |
| CREATE OR REPLACE SERVER "SYS_MOCK_FOREIGN_DATA_SERVER"                                                                                                                                                                       |
| FOREIGN DATA WRAPPER "SYS_MOCK_FOREIGN";                                                                                                                                                                                      |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
> -- should fail since it doesn't exist
> select statement from table(sys_boot.mgmt.generate_ddl_for_catalog(
>     '02FAC378-F888-11DF-B152-E56DDFD72085'));
Error: Reference to unknown catalog: 02FAC378-F888-11DF-B152-E56DDFD72085 (state=,code=0)
> 
> -- test schema, table, view, functions, procedures, jars
> -- also runs catalog-specific functions on sys_fem, which should all be empty.
> create schema reznor;
> 
> create table reznor.rhino (
>   a int primary key,
>   b int
> );
> 
> create view reznor.r_view as
>   select a, b from reznor.rhino;
> 
> create function reznor.eat(plumber varchar(32))
> returns varchar(20)
> contains sql
> return case
>   when plumber = 'Mario' then 'Luigi'
>   else 'Mario' end;
> 
> create jar reznor.rez_jar
> library 'file:${FARRAGO_HOME}/plugin/FarragoMedJdbc.jar'
> options(0);
> 
> create procedure reznor.r_kill(in id bigint)
>   language java
>   parameter style java
>   no sql
>   external name 'class net.sf.farrago.syslib.FarragoKillUDR.killSession';
> 
> select statement from table(sys_boot.mgmt.generate_ddl_for_schema('REZNOR'));
Error: Reference to unknown catalog: 02FAC378-F888-11DF-B152-E56DDFD72085 (state=,code=0)
> select statement from table(sys_boot.mgmt.generate_ddl_for_schema(
>     'LOCALDB', 'REZNOR'));
+--------------------------------------------------------------------------+
|                                STATEMENT                                 |
+--------------------------------------------------------------------------+
| CREATE OR REPLACE SCHEMA "REZNOR";                                       |
|                                                                          |
| CREATE TABLE "REZNOR"."RHINO" (                                          |
|    "A" INTEGER NOT NULL,                                                 |
|    "B" INTEGER,                                                          |
|    PRIMARY KEY ("A")                                                     |
| );                                                                       |
|                                                                          |
| CREATE OR REPLACE JAR "REZNOR"."REZ_JAR"                                 |
| LIBRARY 'file:${FARRAGO_HOME}/plugin/FarragoMedJdbc.jar'                 |
| OPTIONS(0);                                                              |
|                                                                          |
| CREATE OR REPLACE FUNCTION "REZNOR"."EAT"(                               |
|   "PLUMBER" VARCHAR(32))                                                 |
| RETURNS VARCHAR(20)                                                      |
| SPECIFIC "REZNOR"."EAT"                                                  |
| LANGUAGE SQL                                                             |
| CONTAINS SQL                                                             |
| NOT DETERMINISTIC                                                        |
| RETURN CASE WHEN "PLUMBER" = 'Mario' THEN 'Luigi' ELSE 'Mario' END;      |
|                                                                          |
| CREATE OR REPLACE PROCEDURE "REZNOR"."R_KILL"(                           |
|   IN "ID" BIGINT)                                                        |
| SPECIFIC "REZNOR"."R_KILL"                                               |
| LANGUAGE JAVA                                                            |
| NO SQL                                                                   |
| NOT DETERMINISTIC                                                        |
| EXTERNAL NAME 'class net.sf.farrago.syslib.FarragoKillUDR.killSession';  |
|                                                                          |
| CREATE OR REPLACE VIEW "REZNOR"."R_VIEW" AS                              |
| SELECT "RHINO"."A", "RHINO"."B"                                          |
| FROM "LOCALDB"."REZNOR"."RHINO" AS "RHINO";                              |
+--------------------------------------------------------------------------+
> select statement from
>   table(sys_boot.mgmt.generate_ddl_for_table('REZNOR', 'RHINO'));
+----------------------------------+
|            STATEMENT             |
+----------------------------------+
| CREATE TABLE "REZNOR"."RHINO" (  |
|    "A" INTEGER NOT NULL,         |
|    "B" INTEGER,                  |
|    PRIMARY KEY ("A")             |
| );                               |
+----------------------------------+
> select statement from
>   table(sys_boot.mgmt.generate_ddl_for_table('LOCALDB', 'REZNOR', 'RHINO'));
+----------------------------------+
|            STATEMENT             |
+----------------------------------+
| CREATE TABLE "REZNOR"."RHINO" (  |
|    "A" INTEGER NOT NULL,         |
|    "B" INTEGER,                  |
|    PRIMARY KEY ("A")             |
| );                               |
+----------------------------------+
> select statement from
>   table(sys_boot.mgmt.generate_ddl_for_table('REZNOR', 'R_VIEW'));
+----------------------------------------------+
|                  STATEMENT                   |
+----------------------------------------------+
| CREATE OR REPLACE VIEW "REZNOR"."R_VIEW" AS  |
| SELECT "RHINO"."A", "RHINO"."B"              |
| FROM "LOCALDB"."REZNOR"."RHINO" AS "RHINO";  |
+----------------------------------------------+
> select statement from
>   table(sys_boot.mgmt.generate_ddl_for_table('REZNOR', 'not_exist'));
Error: No matching objects found for DDL generation (state=,code=0)
> select statement from
>   table(sys_boot.mgmt.generate_ddl_for_routine('REZNOR', 'EAT'));
+----------------------------------------------------------------------+
|                              STATEMENT                               |
+----------------------------------------------------------------------+
| CREATE OR REPLACE FUNCTION "REZNOR"."EAT"(                           |
|   "PLUMBER" VARCHAR(32))                                             |
| RETURNS VARCHAR(20)                                                  |
| SPECIFIC "REZNOR"."EAT"                                              |
| LANGUAGE SQL                                                         |
| CONTAINS SQL                                                         |
| NOT DETERMINISTIC                                                    |
| RETURN CASE WHEN "PLUMBER" = 'Mario' THEN 'Luigi' ELSE 'Mario' END;  |
+----------------------------------------------------------------------+
> select statement from
>   table(sys_boot.mgmt.generate_ddl_for_routine('LOCALDB', 'REZNOR', 'EAT'));
+----------------------------------------------------------------------+
|                              STATEMENT                               |
+----------------------------------------------------------------------+
| CREATE OR REPLACE FUNCTION "REZNOR"."EAT"(                           |
|   "PLUMBER" VARCHAR(32))                                             |
| RETURNS VARCHAR(20)                                                  |
| SPECIFIC "REZNOR"."EAT"                                              |
| LANGUAGE SQL                                                         |
| CONTAINS SQL                                                         |
| NOT DETERMINISTIC                                                    |
| RETURN CASE WHEN "PLUMBER" = 'Mario' THEN 'Luigi' ELSE 'Mario' END;  |
+----------------------------------------------------------------------+
> select statement from
>   table(sys_boot.mgmt.generate_ddl_for_routine('REZNOR', 'R_KILL'));
+--------------------------------------------------------------------------+
|                                STATEMENT                                 |
+--------------------------------------------------------------------------+
| CREATE OR REPLACE PROCEDURE "REZNOR"."R_KILL"(                           |
|   IN "ID" BIGINT)                                                        |
| SPECIFIC "REZNOR"."R_KILL"                                               |
| LANGUAGE JAVA                                                            |
| NO SQL                                                                   |
| NOT DETERMINISTIC                                                        |
| EXTERNAL NAME 'class net.sf.farrago.syslib.FarragoKillUDR.killSession';  |
+--------------------------------------------------------------------------+
> select statement from
>   table(sys_boot.mgmt.generate_ddl_for_jar('REZNOR', 'REZ_JAR'));
+-----------------------------------------------------------+
|                         STATEMENT                         |
+-----------------------------------------------------------+
| CREATE OR REPLACE JAR "REZNOR"."REZ_JAR"                  |
| LIBRARY 'file:${FARRAGO_HOME}/plugin/FarragoMedJdbc.jar'  |
| OPTIONS(0);                                               |
+-----------------------------------------------------------+
> select statement from
>   table(sys_boot.mgmt.generate_ddl_for_jar('LOCALDB', 'REZNOR', 'REZ_JAR'));
+-----------------------------------------------------------+
|                         STATEMENT                         |
+-----------------------------------------------------------+
| CREATE OR REPLACE JAR "REZNOR"."REZ_JAR"                  |
| LIBRARY 'file:${FARRAGO_HOME}/plugin/FarragoMedJdbc.jar'  |
| OPTIONS(0);                                               |
+-----------------------------------------------------------+
> 
> -- should fail:  schema does not exist
> select statement from
>   table(sys_boot.mgmt.generate_ddl_for_jar('LOCALDB', 'PEZNOR', 'REZ_JAR'));
Error: No matching objects found for DDL generation (state=,code=0)
> 
> -- UNIQUE constraints
> create table reznor.rezzy (a int primary key, b int unique);
> create table reznor.rezzy2 (
>   a int primary key,
>   b int not null,
>   c int not null,
>   d int not null,
>   e int not null,
>   CONSTRAINT b_and_c UNIQUE(b, c),
>   CONSTRAINT d_and_e UNIQUE(d, e));
> select statement from
>   table(sys_boot.mgmt.generate_ddl_for_table('REZNOR', 'REZZY'));
+-----------------------------------------------------+
|                      STATEMENT                      |
+-----------------------------------------------------+
| CREATE TABLE "REZNOR"."REZZY" (                     |
|    "A" INTEGER NOT NULL,                            |
|    "B" INTEGER,                                     |
|    PRIMARY KEY ("A"),                               |
|    CONSTRAINT "SYS$UNIQUE_KEY$REZZY$B" UNIQUE("B")  |
| );                                                  |
+-----------------------------------------------------+
> select statement from
>   table(sys_boot.mgmt.generate_ddl_for_table('REZNOR', 'REZZY2'));
+-------------------------------------------+
|                 STATEMENT                 |
+-------------------------------------------+
| CREATE TABLE "REZNOR"."REZZY2" (          |
|    "A" INTEGER NOT NULL,                  |
|    "B" INTEGER NOT NULL,                  |
|    "C" INTEGER NOT NULL,                  |
|    "D" INTEGER NOT NULL,                  |
|    "E" INTEGER NOT NULL,                  |
|    PRIMARY KEY ("A"),                     |
|    CONSTRAINT "B_AND_C" UNIQUE("B","C"),  |
|    CONSTRAINT "D_AND_E" UNIQUE("D","E")   |
| );                                        |
+-------------------------------------------+
> 
> -- test overloaded routine
> create function reznor.eat(xy varchar(32), uv varchar(32))
> returns varchar(20)
> contains sql
> specific eat2
> return xy;
> 
> -- should show both
> select statement from
>   table(sys_boot.mgmt.generate_ddl_for_routine('REZNOR', 'EAT'));
+----------------------------------------------------------------------+
|                              STATEMENT                               |
+----------------------------------------------------------------------+
| CREATE OR REPLACE FUNCTION "REZNOR"."EAT"(                           |
|   "PLUMBER" VARCHAR(32))                                             |
| RETURNS VARCHAR(20)                                                  |
| SPECIFIC "REZNOR"."EAT"                                              |
| LANGUAGE SQL                                                         |
| CONTAINS SQL                                                         |
| NOT DETERMINISTIC                                                    |
| RETURN CASE WHEN "PLUMBER" = 'Mario' THEN 'Luigi' ELSE 'Mario' END;  |
|                                                                      |
| CREATE OR REPLACE FUNCTION "REZNOR"."EAT"(                           |
|   "XY" VARCHAR(32),                                                  |
|   "UV" VARCHAR(32))                                                  |
| RETURNS VARCHAR(20)                                                  |
| SPECIFIC "REZNOR"."EAT2"                                             |
| LANGUAGE SQL                                                         |
| CONTAINS SQL                                                         |
| NOT DETERMINISTIC                                                    |
| RETURN "XY";                                                         |
+----------------------------------------------------------------------+
> -- should show just second one
> select statement from
>   table(sys_boot.mgmt.generate_ddl_for_specific_routine('REZNOR', 'EAT2'));
+---------------------------------------------+
|                  STATEMENT                  |
+---------------------------------------------+
| CREATE OR REPLACE FUNCTION "REZNOR"."EAT"(  |
|   "XY" VARCHAR(32),                         |
|   "UV" VARCHAR(32))                         |
| RETURNS VARCHAR(20)                         |
| SPECIFIC "REZNOR"."EAT2"                    |
| LANGUAGE SQL                                |
| CONTAINS SQL                                |
| NOT DETERMINISTIC                           |
| RETURN "XY";                                |
+---------------------------------------------+
> 
> -- test index
> create index rhino_idx on reznor.rhino(a);
> select statement from table(sys_boot.mgmt.generate_ddl_for_index(
>     'REZNOR', 'RHINO_IDX'));
+------------------------------------------------------+
|                      STATEMENT                       |
+------------------------------------------------------+
| CREATE INDEX "RHINO_IDX" ON "REZNOR"."RHINO" ("A");  |
+------------------------------------------------------+
> select statement from table(sys_boot.mgmt.generate_ddl_for_index(
>     'LOCALDB', 'REZNOR', 'RHINO_IDX'));
+------------------------------------------------------+
|                      STATEMENT                       |
+------------------------------------------------------+
| CREATE INDEX "RHINO_IDX" ON "REZNOR"."RHINO" ("A");  |
+------------------------------------------------------+
> drop index reznor.rhino_idx;
> drop schema reznor cascade;
> 
> -- test server created earlier
> select statement from
>   table(sys_boot.mgmt.generate_ddl_for_server('TEST_SERVER2'));
+------------------------------------------+
|                STATEMENT                 |
+------------------------------------------+
| CREATE OR REPLACE SERVER "TEST_SERVER2"  |
| FOREIGN DATA WRAPPER "SYS_FILE_WRAPPER"  |
| OPTIONS (                                |
|   "DIRECTORY" 'testgen/mgmt_files/',     |
|   "FILE_EXTENSION" 'csv',                |
|   "LENIENT" 'no',                        |
|   "WITH_HEADER" 'yes'                    |
| );                                       |
+------------------------------------------+
> drop server test_server2;
> 
> -- test wrapper
> create foreign data wrapper hsqldb_wrapper2
> library '${FARRAGO_HOME}/plugin/FarragoMedJdbc.jar'
> language java
> options(
>     browse_connect_description 'Hypersonic',
>     driver_class 'org.hsqldb.jdbcDriver',
>     url 'jdbc:hsqldb:path/to/data'
> );
> select statement from
>   table(sys_boot.mgmt.generate_ddl_for_wrapper('HSQLDB_WRAPPER2'));
+---------------------------------------------------------------------------------------------------------------+
|                                                   STATEMENT                                                   |
+---------------------------------------------------------------------------------------------------------------+
| CREATE OR REPLACE FOREIGN DATA WRAPPER "HSQLDB_WRAPPER2" LIBRARY '${FARRAGO_HOME}/plugin/FarragoMedJdbc.jar'  |
| LANGUAGE JAVA                                                                                                 |
| OPTIONS (                                                                                                     |
|   "BROWSE_CONNECT_DESCRIPTION" 'Hypersonic',                                                                  |
|   "DRIVER_CLASS" 'org.hsqldb.jdbcDriver',                                                                     |
|   "URL" 'jdbc:hsqldb:path/to/data'                                                                            |
| );                                                                                                            |
+---------------------------------------------------------------------------------------------------------------+
> drop foreign data wrapper hsqldb_wrapper2;
> 
> -- test user
> create user peachy identified by 'toadstool';
> select statement from table(sys_boot.mgmt.generate_ddl_for_user('PEACHY'));
+----------------------------------+
|            STATEMENT             |
+----------------------------------+
| CREATE OR REPLACE USER "PEACHY"  |
| IDENTIFIED BY '********';        |
+----------------------------------+
> 
> -- test role
> create role xyz with admin peachy;
> select statement from table(sys_boot.mgmt.generate_ddl_for_role('XYZ'));
+--------------------------------+
|           STATEMENT            |
+--------------------------------+
| CREATE OR REPLACE ROLE "XYZ";  |
+--------------------------------+
> drop role xyz;
> drop user peachy;
> 
> -- test label: (can only be created and dropped in the LucidDB personality)
> alter session implementation set jar sys_boot.sys_boot.luciddb_plugin;
> create label alabel description 'some label';
> create label alabel2 from label alabel description 'child label';
> select statement from table(sys_boot.mgmt.generate_ddl_for_label('ALABEL'));
+-----------------------------------+
|             STATEMENT             |
+-----------------------------------+
| CREATE OR REPLACE LABEL "ALABEL"  |
| DESCRIPTION 'some label';         |
+-----------------------------------+
> select statement from table(sys_boot.mgmt.generate_ddl_for_label('ALABEL2'));
+--------------------------------------------------------+
|                       STATEMENT                        |
+--------------------------------------------------------+
| CREATE OR REPLACE LABEL "ALABEL2" FROM LABEL "ALABEL"  |
| DESCRIPTION 'child label';                             |
+--------------------------------------------------------+
> drop label alabel cascade;
> 
> 
> !quit
