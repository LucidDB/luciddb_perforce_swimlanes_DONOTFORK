<?xml version="1.0" encoding="UTF-8"?>
<!-- 
// $Id$
// Farrago is an extensible data management system.
// Copyright (C) 2005 The Eigenbase Project
// Copyright (C) 2005 SQLstream, Inc.
// Copyright (C) 2005 Dynamo BI Corporation
//
// This program is free software; you can redistribute it and/or modify it
// under the terms of the GNU General Public License as published by the Free
// Software Foundation; either version 2 of the License, or (at your option)
// any later version approved by The Eigenbase Project.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//  
// You should have received a copy of the GNU General Public License
// along with this program; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-->

<!-- Farrago ant script for creating distributions -->

<project name="farragoDistribution" basedir="." default="mustSpecify">

  <import file="./../buildMacros.xml"/>

  <!-- Load properties needed to derive release spec. -->
  <property file="FarragoRelease.properties"/>
  <fail unless="package.name"/>
  <fail unless="product.version.major"/>
  <fail unless="product.version.minor"/>
  <fail unless="product.version.point"/>
  <property 
    name="release.spec" 
    value="${package.name}-${product.version.major}.${product.version.minor}.${product.version.point}"/>


  <!-- Directories and filenames for distribution jar file. -->
  <property name="dist.dir" location="${farrago.dir}/dist"/>
  <property name="dist.plugin.dir" location="${dist.dir}/plugin"/>
  <property name="dist.jar.file" location="${dist.dir}/farrago.jar"/>
  <property name="dist.jar.jdbc.file" location="${dist.dir}/farrago-jdbc.jar"/>
  <property name="dist.jar.jdbc.client.file" location="${dist.dir}/farrago-jdbc-client.jar"/>
  <property name="dist.jar.jdbc.engine.file" location="${dist.dir}/farrago-jdbc-engine.jar"/>


  <property name="release.dir" location="${dist.dir}/tmp/${release.spec}"/>

  <target name="createReleaseDir">
    <mkdir dir="${release.dir}"/>
  </target>

  <target name="allJars" depends="cleanJars,jar,jdbcClientOnlyJar,jdbcJar,jdbcEngineOnlyJar" >
  </target>

  <!-- Cleans up everything --> 
  <target name="clean" depends="cleanJars">
    <delete dir="${release.dir}" quiet="true"/>
  </target>

  <!-- Cleans just jars -->
  <target name="cleanJars">
    <delete file="${dist.jar.file}" quiet="true"/>
    <delete file="${dist.jar.jdbc.file}" quiet="true"/>
    <delete file="${dist.jar.jdbc.client.file}" quiet="true"/>
    <delete file="${dist.jar.jdbc.engine.file}" quiet="true"/>
    <delete file="${dist.jar.jdbc.engine.file}" quiet="true"/>
  </target>

  <target name="jar">
    <delete file="${dist.jar.file}" quiet="true"/>
    <jar destfile="${dist.jar.file}" update="true" compress="true">
      <fileset dir="${farrago.dir}">
        <include name="README"/>
        <include name="COPYING"/>
      </fileset>
      <fileset dir="${farrago.classes.dir}">
        <include name="**/*.class"/>
        <include name="**/*.properties"/>
        <include name="FarragoEhCache.xml"/>
      </fileset>
      <fileset dir="${farrago.catalog.src.dir}">
        <include name="**/*.class"/>
        <include name="META-INF/enki/**"/>
      </fileset>
      <fileset dir="${dist.dir}">
        <include name="FarragoRelease.properties"/>
      </fileset>
    </jar>
    <copy file="${farrago.plugin.dir}/FarragoMedJdbc.jar" 
      todir="${dist.plugin.dir}"/>
    <jar destfile="${dist.plugin.dir}/FarragoMedJdbc.jar" update="true">
      <fileset dir="${farrago.dir}">
        <include name="README"/>
        <include name="COPYING"/>
      </fileset>
    </jar>
    <war destfile="${dist.dir}/vjdbc_servlet.war" 
      webxml="${farrago.dir}/ext/vjdbc/web.xml">
      <fileset dir="${thirdparty.dir}/vjdbc/conf/servlet">
        <include name="*.html"/>
        <exclude name="applet.html"/>
      </fileset>
      <webinf dir="${farrago.dir}/ext/vjdbc">
        <include name="vjdbc-config"/>
      </webinf>
      <lib dir="${thirdparty.dir}/vjdbc/lib" excludes="j2ee_api.jar,junit.jar"/>
    </war>
  </target>
  <target name="jdbcClientOnlyJar">
    <jar destfile="${dist.jar.jdbc.client.file}" update="true" compress="true" filesetmanifest="skip">
      <fileset dir="${farrago.classes.dir}">
        <include
          name="net/sf/farrago/jdbc/client/FarragoVjdbcClientDriver.class"/>
        <include
          name="net/sf/farrago/jdbc/client/FarragoVjdbcHttpClientDriver.class"/>
        <include
          name="net/sf/farrago/jdbc/client/FarragoUnregisteredVjdbcClientDriver.class"/>
        <include
          name="net/sf/farrago/jdbc/client/FarragoUnregisteredVjdbcHttpClientDriver.class"/>
        <include
          name="net/sf/farrago/jdbc/FarragoAbstractJdbcDriver.class"/>
        <include
          name="net/sf/farrago/release/*"/>
        <include
          name="org/eigenbase/util/property/*"/>
        <include
          name="org/eigenbase/util14/ConnectStringParser.class"/>
      </fileset>
    </jar>
  </target>
  <target name="jdbcJar">
    <jar destfile="${dist.jar.jdbc.file}" update="true" compress="true" filesetmanifest="skip">
      <fileset dir="${farrago.classes.dir}">
	<include name="net/sf/farrago/jdbc/**/*.class"/>
        <include
          name="net/sf/farrago/release/*"/>
        <include
          name="org/eigenbase/util/property/*"/>
        <include
          name="org/eigenbase/util14/ConnectStringParser.class"/>
      </fileset>
    </jar>
  </target>
  <target name="jdbcEngineOnlyJar">
    <jar destfile="${dist.jar.jdbc.engine.file}" update="true" compress="true" filesetmanifest="skip">
      <fileset dir="${farrago.classes.dir}">
	<include name="net/sf/farrago/jdbc/engine/*.class"/>
        <include
          name="net/sf/farrago/jdbc/FarragoAbstractJdbcDriver.class"/>
        <include
          name="net/sf/farrago/release/*"/>
        <include
          name="org/eigenbase/util/property/*"/>
        <include
          name="org/eigenbase/util14/ConnectStringParser.class"/>
      </fileset>
    </jar>
  </target>
      
  <!-- TODO jvs 26-June-2005:  this isn't used yet -->
  <target name="createPlannervizRelease">
    <copy 
      file="${farrago.dir}/examples/plannerviz/plugin/FarragoPlannerviz.jar" 
      todir="${dist.plugin.dir}"/>
    <jar destfile="${dist.plugin.dir}/FarragoPlannerviz.jar" update="true">
      <fileset dir="${farrago.dir}">
        <include name="README"/>
        <include name="COPYING"/>
      </fileset>
    </jar>
  </target>
</project>
