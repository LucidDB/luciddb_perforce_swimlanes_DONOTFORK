<html>

<head>
<title>Farrago Developer Jumpstart</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" />

</head>

<body>

<h1>Getting Started With Farrago</h1>

This document provides instructions on how to build and run Farrago.

<h2>Supported Platforms</h2>

So far, the Fennel kernel only runs on Linux and Windows.  This means
to actually store data in Farrago, you have to be running one of these
operating systems.  However, the Java portion is likely to run on
other platforms where JDK 1.4 is available.  You can use it to test
parsing, validation, optimization, and the metadata aspects of DDL, as
well as queries against foreign data accessible via Java (a
sample <a href="http://hsqldb.sf.net">HSQLDB</a> source is provided
for testing JDBC, and the <a href="howto/medmdr.html">MDR HOWTO</a>
explains MDR/JMI usage).

<p>

So, if you're working on a task that doesn't require Fennel, you can
do the development anywhere.  If you need Fennel, then you have a few
options:

<ul>

<li>use your own Linux or Windows box if you have one

<li>use one of the Sourceforge compile farm machines (Fennel has
been successfully tested on some of them)

<li>work on porting Fennel to your platform!

</ul>

<h2>Important Windows Note</h2>

If you are using Windows, please read and follow the <a
href="cygwinSetup.html">Cygwin setup instructions</a> before going any
further.  

<h2>Get the Source Code</h2>

Currently, the only way to build Farrago is to get the source from
Perforce.  (If you just want to take a look-see through the codebase,
you can use <a href="http://p4web.eigenbase.org/open/dev/farrago/">
p4web</a>.)  If you're new to Perforce, you might want to read the
official <a
href="http://www.perforce.com/perforce/doc.022/manuals/boilerplates/quickstart.html">
Perforce Quick Start</a>.  If you don't already have p4.exe, download
the appropriate binary from 
<a href="http://www.perforce.com/perforce/loadprog.html">
Perforce</a> (you only need the client, not the server).

<p>

There are a number of ways to configure Perforce depending on the
platform (on Windows through the GUI, on Unix through environment
variables or a .p4env file).  The essential information you need to
provide is:

<ul>
<li>P4PORT=perforce.eigenbase.org:1666
<li>P4USER=your-sourceforge-user-name
<li>P4CLIENT=your-user-name.your-hostname
</ul>

In order to make changes, you'll need to send your username to the
Farrago project admin and request write access.  If you don't have a
Sourceforge account yet, <a href="http://sf.net/account/register.php">
go get one</a>.  For read-only clients (like if you just want a
snapshot of the latest code), use the predefined username "guest" (the
server license has a user limit, but there's no limit on the number of
clients, so feel free to create multiple workspaces on as many
machines as needed).

<p>

Once you've got Perforce set up, run <code>p4 client</code>
(or edit your default clientspec from P4WIN).  
You need to map the following views:

<pre><code>
//open/dev/thirdparty/...
//open/dev/fennel/...
//open/dev/farrago/...

</code></pre>

All of these should be mapped to a common root corresponding to
<code>//open/dev</code> (you can call it whatever you like on your
local filesystem, but we'll refer to it as <code>dev</code> in this
and other developer docs).

<p>

While editing your client, you should also set the
<code>LineEnd</code> attribute to <code>share</code>, especially if
you are developing on Windows or using Samba.  This prevents DOS
CRLF's from getting checked in.

<p>

Finally, run <code>p4 sync</code> to get all the source files and
thirdparty distributions into your client workspace.  This may take a
while because some of the thirdparty distributions are large.  You
should also make sure you have <a
href="http://java.sun.com/j2se/1.4">JDK 1.4</a> or higher installed,
with JAVA_HOME set to the JDK installation root.

<p>

If you will be building Fennel, now is the time to make sure you have
the correct versions of the required build tools such as autoconf.
The file <code>dev/fennel/INSTALL</code> (and
<code>dev/fennel/INSTALL.mingw</code> for Windows) has more
information.  If your autotools are out of date, you can either
install updated packages for your Linux or Cygwin distribution, or
build them from source by running <code>make autotools</code> in
directory <code>dev/thirdparty</code> and then following the
installation instructions.

<p>

You can ignore the Fennel instructions for building STLport,
Boost, and Fennel manually, since the next step is going to take care
of all of that automatically.

<h2>Initial Build</h2>

For the first build in a new sandbox, there's a lot of
one-time setup that needs to be done, including building some
of the third-party components from source.  This process is automated
by the script <code>dev/farrago/initBuild.sh</code>.  Change to the
<code>dev/farrago</code> directory and run the initial build as follows:

<pre><code>
initBuild.sh --with-fennel

  or

initBuild.sh --without-fennel

</code></pre>

If you're building without Fennel, this should be fairly quick (under
ten minutes on most machines); with Fennel it will take quite a bit
longer.  If all goes well, you'll be left with a complete Farrago
build for your platform.  Otherwise, you'll need to dig into the
script and its output to see what's going wrong.  If you can't figure
it out, ask for help on the <a href="#Feedback">farrago-developers
mailing list</a>.  You should probably include the last 100 lines of
build output including the error.

<h2>Environment Variables</h2>

The initial build script takes care of setting some necessary
environment variables internally, but once it completes they are left
unset.  For subsequent runs and builds of Farrago, you will need to
make sure these are set.  Scripts are provided for this purpose.  You
can run them automatically from a login script such as
<code>.bash_profile</code>, or run them manually before working with
Farrago:

<pre><code>
source dev/fennel/fennelenv.sh dev/fennel
source dev/farrago/farragoenv.sh dev/thirdparty

</code></pre>

As usual, you only need the Fennel script if Fennel support is
enabled.  Don't execute these scripts directly; you must use
<code>.</code> or <code>source</code> in order for the environment
variable settings to take effect for subsequent commands.

<h2>Incremental Builds</h2>

Once you already have a working build, updating to the latest code
requires following these steps:

<ol>

<li>
<code>p4 sync</code>.  You'll probably want to examine the output to
see what has changed (or you can ignore it and blindly carry out the
rest of the steps unconditionally).

<li>
If anything under <code>dev/thirdparty/...</code> has changed, cd to
that directory and run <code>make all</code>.  New
thirdparty components and upgrades to new versions are fairly rare.
Upgrades to C++ components usually require you to repeat the original
initBuild.sh process.

<li>
If anything under <code>dev/fennel/...</code> has changed (and you're
building with Fennel support), cd to that directory and run make.  In
very rare cases, you may need to make clean first (or even rerun
initBuild.sh), but that should be a last resort.

<li>
cd to <code>dev/farrago</code> and run "ant test" to make sure you'll
be working from a good build (WARNING: this will rebuild your catalog
automatically, destroying any data in your Farrago database)

</ol>

If none of the C++ components under thirdparty have been upgraded, and
you'd like to force a rebuild of everything else, skip the steps after
the thirdparty make and instead run

<pre><code>
cd dev/farrago
initBuild.sh --with-fennel --skip-thirdparty

</code></pre>

This will recapitulate the original full build, but skipping the
time-consuming thirdparty C++ components.

<h2>Catalog Dump</h2>

At any time, you can get a dump of the catalog by running <code>ant
exportCatalog</code>; the output will be an XMI file in
<code>dev/farrago/catalog/xmi/FarragoCatalogExport.xmi</code>.
This can be useful for debugging the effects of DDL
execution.

<h2>Catalog Backup/Restore</h2>

The <code>ant createCatalog</code> task (invoked automatically as part
of <code>ant test</code>) creates a backup of the initial catalog (and
database if Fennel is enabled).  If your catalog gets corrupted, you
can recover with <code>ant restoreCatalog</code>.  This is a lot
faster than <code>ant createCatalog</code> (which is another way to
get back to a good state).

<h2>Interactive SQL</h2>

You can execute interactive SQL from a command-line via the
open-source JDBC <a href="http://sqlline.sourceforge.net">sqlline</a>
project.  Just run the <code>sqllineEngine</code> script from dev/farrago.
After connecting, try <code>select * from sales.emps;</code>
(but if you disabled Fennel, don't be disappointed when the result set
comes back empty).

<p>

If you prefer using a GUI, try the <a
href="http://www.isqlviewer.com">iSQL-Viewer</a> project instead.  To
start the GUI, run <code>ant isql</code>.  From the services menu,
choose <code>FarragoEmbedded</code> to start the engine and connect to
it.  This service is predefined from
<code>dev/farrago/isql/FarragoEmbedded.service</code>.  (The
<code>FarragoServer</code> alternative is described later in this
document.)

<h2>Tracing</h2>

Tracing based on the standard <a
href="http://java.sun.com/j2se/1.4.1/docs/api/java/util/logging/package-summary.html#package_description">java.util.logging
facility</a> is controlled by the file
<code>dev/farrago/trace/FarragoTrace.properties</code>, which is
generated when the catalog is created.  You can make modifications to
this file; they won't be overwritten during regeneration.  However,
comments cannot be preserved during regeneration, so don't bother.
Normally, trace output is written to
<code>dev/farrago/trace/FarragoTrace.log</code>.

<p>

The timestamp of the trace configuration file is checked once per
second; whenever it changes, the new configuration is applied
automatically, so there's no need to restart the database.  (TODO:
make this configurable, since that's not always desirable.)

<p>

Farrago classes use the standard logger naming scheme (logger name
matches fully-qualified class name, so for detailed catalog tracing of
the JDBC driver, add <code>net.sf.farrago.jdbc.level=FINE</code>).  However,
Fennel doesn't use the java.util.logging API directly, so it
has a custom logger naming scheme.  Below are some useful trace definitions:

<ul>

<li>add <code>net.sf.farrago.jdbc.level=FINER</code> to trace exceptions which
are returned via the JDBC driver (this is very useful
since it traces underlying exceptions as well; these may
not be visible in a front end such as sqlline);
this is added automatically for developer builds</li>

<li>add <code>net.sf.farrago.db.level=FINE</code> to see all SQL statements
executed (use FINER to see dynamic parameter values as well)</li>

<li>add <code>net.sf.farrago.query.streamgraph.level=FINE</code> to trace
Fennel execution stream graphs

<li>add <code>net.sf.fennel.level=FINE</code>. to turn on all
low-level Fennel tracing (probably more than you want!)

<li>add <code>net.sf.farrago.fennel.level=FINE</code>
to trace just the commands sent to the Fennel API (not their
implementation)

<li>add <code>net.sf.fennel.xo.level=FINE</code> to trace
tuples processed by execution streams

<li>add <code>org.eigenbase.relopt.RelOptPlanner.level=FINE</code> to trace
query optimization

<li>some Fennel classes provide further tracing discrimination (TBD)

</ul>

<h2>Unit Testing</h2>

Please read the <a
href="api/net/sf/farrago/test/package-summary.html#package_description">
test package overview</a> for details.

<h2>Debugging</h2>

Run <code>ant jswat.sqlline</code> or <code>ant jswat.isql</code> to
use the <a href="http://www.bluemarsh.com/java/jswat">JSwat</a>
debugger for execution of interactive SQL commands.  For sqlline,
input/output is performed through the JSwat Output pane at the bottom
left of the screen.  The <code>junitDebug</code> script can also be
used to debug one unit test at a time.  If you want to use another
debugger, the <code>jswatDebug</code> ant macro definition in
<code>dev/farrago/buildMacros.xml</code> might be helpful as a
template for passing the right startup information.  Also, as part of
a successful build, the full classpath is always dumped to the file
<code>dev/farrago/classpath.gen</code>.

<h2>Client/Server Operation</h2>

So far, all of the execution modes discussed have been <em>embedded
engine mode</em>, where the Farrago engine is loaded directly into a
single process such as iSQL-Viewer or sqlline.  This is the most
useful for debugging, but scripts are also available to test
client/server mode.  Run the <code>farragoServer</code> script to
start the server in a shell (after startup, it waits listening for
connections; enter the <code>!quit</code> command in order to shut it
down).  From another shell, run <code>sqllineClient</code> (or
<code>ant isql.client</code>, and choose the
<code>FarragoServer</code> service) to communicate with the server in
client/server mode.  To debug the server, start it with <code>ant
jswat.server</code>.

<h2>Coding</h2>

Please read the incredibly brief <a href="codeStyle.html">code
style</a> doc.  The <a href="bestiary.html">bestiary</a> may also be
helpful.  Before starting development projects, consider using
<a href="privateBranch.html">private branching</a>.

<a name="Feedback">
<h2>Feedback</h2>
</a>

If you have trouble with any of this, or have other questions, use
the <a href="http://sourceforge.net/mail/?group_id=80183">
farrago-developers mailing list</a>.  

</body>

</html>
